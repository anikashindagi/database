<!-- New Data Entry Form -->
<!DOCTYPE html>
<html>
 <head>
    <!-- Load jQuery, Bootstrap, Firebase -->
  <!-- jQuery -->
  <script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
  crossorigin="anonymous"></script>
  <!-- Add html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<!-- Add jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-analytics.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";
    import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";
    import { getStorage,uploadString, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-storage.js";
    const {serverTimestamp } = await import("https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js");
import { ref } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-storage.js";


    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAIDs-jSvlJmf7ga5RCvzvo4RmGQ1kzBDs",
        authDomain: "dataentryportal-17441.firebaseapp.com",
        projectId: "dataentryportal-17441",
        storageBucket: "dataentryportal-17441.firebasestorage.app",
        messagingSenderId: "380052849415",
        appId: "1:380052849415:web:6563eb7973362dab15fba2",
        measurementId: "G-6WQHNQMX2D"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth();
    var currentuser = {};
    const db = getFirestore(app);
    const storage = getStorage(app);

    </script>

<!-- Bootstrap -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
<!-- Add html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<!-- Add jsPDF -->
<!-- Include jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- Include html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheets" href="styles.css">
 </head>
 
<style>
    h1 {text-align: center;}
    h1 {text-align: center;}
    h1 {text-align: center;}
    h1 {text-align: center;}
    h1 {text-align: center;}
    h1 {text-align: center;}
    div {text-align: center;}
    input {text-align: center;}
    option {text-align: center;}
    .hidden {
            display: none !important;
        }
        .canvas-container {
    position: relative;
    display: inline-block;
    margin: 10px;
    width: 300px; /* Adjust width */
    height: auto; /* Maintain aspect ratio */
}

.canvas-container img {
    width: 100%; /* Make the image fit within the container */
    height: auto; /* Maintain aspect ratio */
}

.canvas-container canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%; /* Make the canvas match the image size */
    height: auto;
}

        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

    #add_patient2 {
        background-color: white; /* White background with 30% transparency */
    padding: 20px;
    border-radius: 10px; /* Rounded corners */
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); /* Optional: soft shadow for better visibility */
    color: black; /* Text color for contrast */
    margin-top: 30px;
}

#add_patient1 {
    background-color: white; /* White background with 30% transparency */
    padding: 20px;
    border-radius: 10px; /* Rounded corners */
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); /* Optional: soft shadow for better visibility */
    color: black; /* Text color for contrast */
    margin-top: 30px;
}
.input-fields {
    display: flex;
    justify-content: center;
    gap: 50px; /* Adjust spacing between left and right sections */
    margin-top: 10px;
}

.col {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.input-group {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    margin-bottom: 5px;
}

.input-group label {
    font-weight: bold;
    min-width: 120px; /* Ensures labels are aligned properly */
    text-align: right;
}

.input-group input {
    width: 80px;
    padding: 3px;
    text-align: center;
}


    .form-container {
    background-color: rgba(255, 255, 255, 0.8);
    padding: 20px;
    border-radius: 10px;
    border: 2px solid #333; /* Add this line for the boundary */
    display: inline-block;
    margin-top: 50px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); /* Optional: adds a subtle shadow */
}

    </style>
    <style>
        body {
            background-image: url('img14.png'); /* Replace with your image path */
            background-size: cover;  /* Ensures the image covers the entire background */
            background-position: center;  /* Centers the image */
            height: 100vh;  /* Makes sure the body takes up the full viewport height */
            margin: 0;
            position:relative;
            opacity:1.0;
            
        }
        /* Overlay to make the image translucent */
        .overlay {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(255, 255, 255, 0.6); /* Adjust transparency */
                opacity:0.5;
            }
            .overlay {
    background-color: rgba(255, 255, 255, 0.2); /* Lighter overlay */
}
#form-container {  
    background-color: white !important; /* Fully opaque white */
    opacity: 1;  /* Ensures full opacity */
    padding: 20px;  /* Adds spacing inside the form */
    border-radius: 10px;  /* Optional: Rounds the corners */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Adds a soft shadow for better visibility */
}

    
            .content {
                position: relative;
                z-index: 1; /* Makes sure content is above the overlay */
                text-align: center;
                padding: 5px;
            }
    
            h1, p {
                color: white; /* Text color to contrast the background */
            }

            .amputation-table {
        display: grid;
        grid-template-columns: repeat(8, 1fr); /* 4 columns for left, 4 for right */
        gap: 10px;
        max-width: 800px;
        margin: 20px auto;
        background-color: white;
        padding: 10px;
    }
    .header {
        text-align: center;
        font-weight: bold;
        grid-column: span 4;
    }
    .sub-header {
        font-weight: bold;
        text-align: center;
    }
    .digit-label {
        text-align: center;
        font-weight: bold;
        align-self: center;
    }
    .input-field {
        width: 100%;
        padding: 4px;
        box-sizing: border-box;
    }
            .ms-3 {
    margin-left: 15px;
}
h1, p {
            color: black; /* Text color to contrast the background */
        }
        .d-flex {
    display: flex;
    align-items: center;  /* Ensures vertical centering */
}

.about-image {
    width: 150px; /* Set the width of the image */
    height: auto; /* Keep the image's aspect ratio */
    border-radius: 5px; /* Optional: rounded corners for the image */
}
.hidden {
        display: none;
    }
    .hands-container {
        display: flex;
        gap: 30px;
        flex-wrap: wrap;
    }
    .hand-section {
        flex: 1;
        min-width: 300px;
    }
    .hand-content {
        display: flex;
        gap: 20px;
        align-items: flex-start;
    }
    .image-wrapper {
        position: relative;
        display: inline-block;
    }
    canvas {
        position: absolute;
        top: 0;
        left: 0;
    }
    .wound-details {
        flex: 1;
        min-width: 250px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #fff;
        max-height: 500px;
        overflow-y: auto;
    }
    .wound-input-group {
        padding: 15px;
        border: 1px solid #eee;
        border-radius: 5px;
        margin-bottom: 15px;
    }
    .form-control {
        width: 100%;
    }
    .wound-type-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 15px;
    }
    .wound-type-label {
        font-size: 14px;
        display: flex;
        align-items: center;
    }
    .color-indicator {
        display: inline-block;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin-right: 5px;
    }
    .active-wound-type {
        background-color: #f0f0f0;
        border-left: 4px solid;
        padding: 10px;
        margin-bottom: 10px;
    }
    .no-wounds-message {
        font-style: italic;
        color: #666;
    }
    /* New styles for side-by-side fields */
    .fields-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .field-group {
        flex: 1;
        min-width: 100px;
    }
    /* Surface selection container */
    .surface-selection-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 15px;
    }
    .surface-option {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px;
        flex: 1;
        min-width: 200px;
    }
    .surface-option h5 {
        margin-top: 0;
        margin-bottom: 10px;
    } 
    .hidden {
        display: none;
    }
    .hands-container {
        display: flex;
        gap: 30px;
        flex-wrap: wrap;
    }
    .hand-section {
        flex: 1;
        min-width: 300px;
    }
    .hand-content {
        display: flex;
        gap: 20px;
        align-items: flex-start;
    }
    .image-wrapper {
        position: relative;
        display: inline-block;
    }
    canvas {
        position: absolute;
        top: 0;
        left: 0;
    }
    .wound-details {
        flex: 1;
        min-width: 250px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #fff;
        max-height: 500px;
        overflow-y: auto;
    }
    .wound-input-group {
        padding: 15px;
        border: 1px solid #eee;
        border-radius: 5px;
        margin-bottom: 15px;
    }
    .form-control {
        width: 100%;
    }
    .wound-type-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 15px;
    }
    .wound-type-label {
        font-size: 14px;
        display: flex;
        align-items: center;
    }
    .color-indicator {
        display: inline-block;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin-right: 5px;
    }
    .active-wound-type {
        background-color: #f0f0f0;
        border-left: 4px solid;
        padding: 10px;
        margin-bottom: 10px;
    }
    .no-wounds-message {
        font-style: italic;
        color: #666;
    }
    /* New styles for side-by-side fields */
    .fields-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .field-group {
        flex: 1;
        min-width: 100px;
    }
    /* Surface selection container */
    .surface-selection-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 15px;
    }
    .surface-option {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px;
        flex: 1;
        min-width: 200px;
    }
    .surface-option h5 {
        margin-top: 0;
        margin-bottom: 10px;
    }
    .hidden {
        display: none;
    }
    .hands-container {
        display: flex;
        gap: 30px;
        flex-wrap: wrap;
    }
    .hand-section {
        flex: 1;
        min-width: 300px;
    }
    .hand-content {
        display: flex;
        gap: 20px;
        align-items: flex-start;
    }
    .image-wrapper {
        position: relative;
        display: inline-block;
    }
    canvas {
        position: absolute;
        top: 0;
        left: 0;
    }
    .wound-details {
        flex: 1;
        min-width: 250px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #fff;
        max-height: 500px;
        overflow-y: auto;
    }
    .wound-input-group {
        padding: 15px;
        border: 1px solid #eee;
        border-radius: 5px;
        margin-bottom: 15px;
    }
    .form-control {
        width: 100%;
    }
    .wound-type-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 15px;
    }
    .wound-type-label {
        font-size: 14px;
        display: flex;
        align-items: center;
    }
    .color-indicator {
        display: inline-block;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin-right: 5px;
    }
    .active-wound-type {
        background-color: #f0f0f0;
        border-left: 4px solid;
        padding: 10px;
        margin-bottom: 10px;
    }
    .no-wounds-message {
        font-style: italic;
        color: #666;
    }
    /* New styles for side-by-side fields */
    .fields-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .field-group {
        flex: 1;
        min-width: 100px;
    }
    /* Surface selection container */
    .surface-selection-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 15px;
    }
    .surface-option {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px;
        flex: 1;
        min-width: 200px;
    }
    .surface-option h5 {
        margin-top: 0;
        margin-bottom: 10px;
    }
    </style>
    <style>
        .hidden { display: none; }
        .extensor-flexbox { display: flex; align-items: center; gap: 20px; justify-content: center; }
        .extensor-hand-box { text-align: center; min-width: 300px; }
        .extensor-hand-image { width: 250px; height: auto; border: 1px solid #ccc; border-radius: 5px; }
        .both-hands-container { display: flex; gap: 20px; justify-content: center; }
        .hand-selection { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; background: #fff; }
        label { font-weight: bold; }
        .extensor-checkbox-group, .extensor-radio-group { margin-top: 10px; }
    </style>
    <style>
        .hidden { display: none; }
            .flexor-flexbox { display: flex; align-items: center; gap: 20px; justify-content: center; }
            .flexor-hand-box { text-align: center; min-width: 300px; }
            .flexor-hand-image { width: 250px; height: auto; border: 1px solid #ccc; border-radius: 5px; }
            .both-hands-container { display: flex; gap: 20px; justify-content: center; }
            .hand-selection { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; background: #fff; }
            label { font-weight: bold; }
            .flexor-checkbox-group, .flexor-radio-group { margin-top: 10px; }
    </style>
    <style>
        .vasc_table {
            border-collapse: collapse;
            width: 80%;
            margin: 20px auto;
            border: 2px solid black;
        }
        .vasc_th, .vasc_td {
            border: 2px solid black;
            padding: 8px;
            text-align: center;
        }
        .vasc_th {
            background-color: #f2f2f2;
        }
        .vasc_center {
            text-align: center;
        }
        .vasc_selection-container {
            display: flex;
            justify-content: center;
            gap: 50px;
        }
    </style>
     <style>
        .symptoms {
    margin-top: 15px;
    padding: 15px;
    background-color: #ffffff;
    border-radius: 6px;
    display: none;
}
.symptoms-row {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
}
.symptom-item {
    white-space: nowrap;
}
     </style>
     <style>
        .forearm-measurement-section{
            display:flex;
            flex-wrap:wrap;
            gap:20px;
        }
        .forearm-hand-section-wrapper{
            display:flex;
            flex-direction: row;
            gap: 20px;
            margin-bottom:20px;
        }
        .forearm-hand-container{
            position:relative;
            display:inline-block;
        }
        .forearm-hand-image{
            display:none;
        }
        .forearm-hand-canvas{
            position:absolute;
            top:0;
            left:0;
            display:none;
        }
        .forearm-upload-section{
            display: flex;
            flex-direction: column;
            min-width: 250px;
        }
        .forearm-uploaded-image{
            max-width:100%;
            max-height:300px;
            margin-top:10px;
        }
        .forearm-measurement-panel {
    margin-bottom: 15px;
    padding: 15px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    background-color: #fff;
}
        .forearm-wound-color-indicator{
            display:inline-block;
            width:15px;
            height:15px;
            margin-right:5px;
            border-radius:50%;
        }
        .forearm-measurement-fields-container{
            display: flex;
    flex-direction: row;
    align-items: center;
    gap: 15px;
    margin: 10px 0;
    flex-wrap: wrap;
        }
        .forearm-measurement-field{
            display: flex;
    align-items: center;
    min-width: 200px;
    flex: 1;
        }
        .forearm-measurement-field label{
            width:100px;
            margin-right:10px;
        }
     </style>
<style>
    .neurological-radio-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
    }
    .neurological-table {
        width: 60%;
        margin: 20px auto;
        border-collapse: collapse;
        border: 2px solid black;
    }
    .neurological-table th, .neurological-table td {
        border: 2px solid black;
        padding: 10px;
        text-align: center;
    }
    .neurological-table th {
        background-color: #f2f2f2;
    }
    .hidden {
        display: none;
    }
</style>
<style>
    .bone-form-hidden {
       display: none;
   }
   .bone-form-label {
       font-weight: bold;
       display: block;
       margin-bottom: 10px;
   }
   .bone-radio-container {
       margin-bottom: 15px;
   }
   .bone-radio-container input[type="radio"] {
       margin-right: 5px;
   }
   .bone-radio-container label {
       margin-right: 15px;
   }
   .bone-table {
       width: 100%;
       border-collapse: collapse;
       margin-bottom: 20px;
   }
   .bone-table th, .bone-table td {
       padding: 8px;
       text-align: left;
       border: 1px solid #ddd;
   }
   .bone-table th {
       background-color: #f2f2f2;
   }
   .bone-form-control {
       width: 100%;
       padding: 6px;
       box-sizing: border-box;
   }
   .bone-hand-selection {
       margin-top: 15px;
       margin-bottom: 15px;
   }
   .bone-images-container {
       display: flex;
       flex-wrap: wrap;
       justify-content: center;
       gap: 20px;
       margin-top: 20px;
   }
   .bone-hand-image {
       border: 1px solid #ccc;
       padding: 10px;
       text-align: center;
       position: relative;
   }
   .bone-canvas-container {
       position: relative;
       margin: 0 auto;
   }
   .bone-hand-base-image {
       border: 1px solid #eee;
       display: block;
   }
   .bone-drawing-canvas {
       position: absolute;
       top: 0;
       left: 0;
       cursor: crosshair;
   }
   .bone-drawing-tools {
       margin-top: 10px;
       display: flex;
       justify-content: center;
       gap: 10px;
   }
   .bone-color-picker {
       display: flex;
       gap: 5px;
       margin-bottom: 5px;
   }
   .bone-color-option {
       width: 20px;
       height: 20px;
       border-radius: 50%;
       cursor: pointer;
       border: 2px solid #ddd;
   }
   .bone-color-option.selected {
       border: 2px solid #333;
   }
   .bone-tool-button {
       padding: 5px 10px;
       background: #f0f0f0;
       border: 1px solid #ccc;
       border-radius: 3px;
       cursor: pointer;
   }
</style>
<style>
    /* Additional styles for the new image upload feature */
    .bone-flex-container {
        display: flex;
        gap: 20px;
        align-items: flex-start;
    }
    
    .bone-uploaded-image-container {
        min-width: 250px;
        margin-top: 10px;
    }
    
    .bone-upload-section {
        margin-bottom: 10px;
    }
    
    .bone-upload-label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    
    .bone-uploaded-preview {
        border: 1px dashed #ccc;
        padding: 5px;
        max-width: 250px;
        text-align: center;
        margin-top: 10px;
    }
    
    .bone-uploaded-image {
        max-width: 100%;
        height: auto;
        margin-bottom: 8px;
        border: 1px solid #eee;
    }
    
    .bone-remove-btn {
        margin-top: 5px;
        background-color: #f44336;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 3px;
    }
    
    .bone-remove-btn:hover {
        background-color: #d32f2f;
    }
    </style>
     <style>
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            font-size: 16px;
        }
        td {
            font-size: 14px;
        }
        .classification {
            width: 20%;
            font-size: 12px;
            font-weight: bold;
        }
        .large-column {
            width: 40%;
        }
        .hidden {
            display: none !important;
        }
        /* Modified container styling */
        #imageContainer {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            border: 1px dashed red; /* Adding border to see if container is visible */
            padding: 10px;
            min-height: 120px; /* Ensure container has height even if images don't load */
        }
        .fracture-image {
            width: 100px;
            height: 100px; /* Fixed height instead of auto */
            border: 2px solid black;
            border-radius: 5px;
            background-color: #f0f0f0; /* Background color to see if images are positioned correctly */
            object-fit: contain; /* Maintain aspect ratio */
        }
    </style>
     <style>
        textarea {
width: 100%;
height: 100px;
padding: 10px;
border: 1px solid #ccc;
border-radius: 5px;
resize: none;
}
</style>
    <style>
        .wound-container {
       max-width: 500px;
       margin: 20px auto;
       padding: 20px;
       border: 1px solid #ddd;
       border-radius: 8px;
   }
   #woundDescriptionLowerExtreme {
       width: 100%;
       margin-top: 10px;
       display: none;
   }
   .radio-group {
       display: flex;
       justify-content: center;
       gap: 20px;
       margin-bottom: 15px;
   }
   .hand-container-lower-extreme {
       display: flex;
       gap: 20px;
       justify-content: center;
       margin-top: 20px;
   }
   .hidden {
       display: none;
   }
   .hand-lower-extreme {
       width: 300px;
       cursor: pointer;
       position: relative;
   }
   .marker-lower-extreme {
       position: absolute;
       width: 15px;
       height: 15px;
       background-color: blue; /* Changed marker color for lower limbs */
       border-radius: 50%;
       transform: translate(-50%, -50%);
       cursor: pointer;
   }
   .hand-wrapper {
       position: relative;
   }
   .clear-markers {
       margin-top: 10px;
       text-align: center;
   }
   </style>
   <style>
    .container-spine {
        max-width: 500px;
        margin: 20px auto;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        text-align: center;
    }
    #descriptionBoxSpine {
        width: 100%;
        margin-top: 10px;
        display: none;
        height: 100px; /* Increased height for better usability */
        font-size: 16px; /* Larger text */
        padding: 10px;
    }
</style>
<style>
    .gcs-container {
font-family: Arial, sans-serif;
font-size: 16px;
font-weight: bold;
margin-top: 20px;
text-align: center;
}
select {
padding: 5px;
font-size: 16px;
width: 100px;
text-align: center;
}
</style>
<style>
    #videoContainer {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        gap: 10px;
    }
    video {
        max-width: 300px;
    }
</style>
<style>
    .container-abdomen {
        max-width: 500px;
        margin: 20px auto;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        text-align: center;
    }
    #descriptionBoxabdomen {
        width: 100%;
        margin-top: 10px;
        display: none;
        height: 100px; /* Increased height for better usability */
        font-size: 16px; /* Larger text */
        padding: 10px;
    }
</style>
   <style>
    .wound-container {
        max-width: 500px;
        margin: 20px auto;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
    }
    #woundDescriptionChest {
        width: 100%;
        margin-top: 10px;
        display: none;
    }
    .radio-group {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 15px;
    }
    .chest-container {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }
    .hidden {
        display: none;
    }
    .chest-image {
        width: 350px;
        cursor: pointer;
        position: relative;
    }
    .marker-chest {
        position: absolute;
        width: 15px;
        height: 15px;
        background-color: red;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        cursor: pointer;
    }
    .chest-wrapper {
        position: relative;
    }
    .clear-markers {
        margin-top: 10px;
        text-align: center;
    }
</style>
<style>
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid black;
        padding: 10px;
        text-align: left;
    }
    th {
        background-color: #f4f4f4;
    }
</style>
    <style>
        .hidden { display: none; }
            table { width: 50%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid black; padding: 10px; text-align: left; }
            th { background-color: lightgray; }
            .image-container { display: flex; gap: 20px; margin-top: 20px; justify-content: center; }
            .image-container img { width: 400px; height: 300px; border-radius: 10px; }
            .separator {
        width: 2px; /* Set width for a vertical line */
        background-color: black; /* Line color */
        height: 100%; /* Stretch it to full height */
        margin: 0 10px; /* Space between elements */
        display: inline-block; /* Ensures it stays inline */
    }
    </style>
    <style>
        .container2 {
            display: flex;
            justify-content: space-between;
            max-width: 600px;
            margin: auto;
        }
        .column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        } 
    </style>
<style>
    .wound-container {
       max-width: 500px;
       margin: 20px auto;
       padding: 20px;
       border: 1px solid #ddd;
       border-radius: 8px;
   }
   #woundDescription {
       width: 100%;
       margin-top: 10px;
       display: none;
   }
   .radio-group {
       display: flex;
       justify-content: center;
       gap: 20px;
       margin-bottom: 15px;
   }
   .hand-container-extreme {
       display: flex;
       gap: 20px;
       justify-content: center;
       margin-top: 20px;
   }
   .hidden {
       display: none;
   }
   .hand-extreme {
       width: 300px;
       cursor: pointer;
       position: relative;
   }
   .marker {
       position: absolute;
       width: 15px;
       height: 15px;
       background-color: red;
       border-radius: 50%;
       transform: translate(-50%, -50%);
       cursor: pointer;
   }
   .hand-wrapper {
       position: relative;
   }
   .clear-markers {
       margin-top: 10px;
       text-align: center;
   }
</style>

     <body>

        <div class="container mt-4">
            <div class="d-flex justify-content-center align-items-center">
                <!-- Image on the left side of the heading -->
                <img src="manipallogo.png" alt="Department Logo" class="about-image" style="height: 80px;" />
                <!-- Heading text -->
                <h1 class="ms-3 text-center">Department of Hand Surgery, KMC</h1>
            </div>
        </div>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Hand Surgery Dept.</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" id="browse"></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="add"></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-danger" href="#" id="logout">Logout</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    <div class="container" id="add_patient1">
     <h3>Acute Hand Injury Sheet( Part 1 )</h3>
     <div class="well">
         
         <form id="form1">
            <div class="container1">
            <div class="row">
                <!-- Patient Name -->
                <div class="col-md-4">
                    <label for="PatientName" class="form-label fw-bold">Patient Name</label>
                    <input type="text" class="form-control" id="PName1">
                </div>
            
                <!-- Patient Age -->
                <div class="col-md-4">
                    <label for="PatientAge" class="form-label fw-bold">Patient Age</label>
                    <input type="text" class="form-control" id="PAge1">
                </div>
            
                <!-- Patient Sex (Radio Buttons) -->
                <div class="col-md-4">
                    <label class="form-label fw-bold">Patient Sex</label>
                    <div class="d-flex justify-content-end pe-4">  
                        <div class="form-check me-3">
                            <input class="form-check-input" type="radio" name="patientSex" id="male" value="Male">
                            <label class="form-check-label" for="male">Male</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="radio" name="patientSex" id="female" value="Female">
                            <label class="form-check-label" for="female">Female</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="patientSex" id="other" value="Other">
                            <label class="form-check-label" for="other">Other</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Second Row: Hospital No & Occupation -->
            <div class="row mt-3 align-items-center">  
                <!-- Hospital No -->
                <div class="col-md-4">
                    <label for="HospitalNo" class="form-label fw-bold">Hospital No</label>
                    <input type="text" class="form-control" id="HospitalNo">
                </div>
            
                <!-- Occupation -->
                <div class="col-md-4">
                    <label for="Occupation" class="form-label fw-bold">Occupation</label>
                    <input type="text" class="form-control" id="occu">
                </div>
            
                <!-- MLC/Non-MLC (Radio Buttons) -->
                <div class="col-md-4">
                    <label class="form-label fw-bold">MLC / Non-MLC</label>
                    <div class="d-flex justify-content-end pe-4">  
                        <div class="form-check me-3">
                            <input class="form-check-input" type="radio" name="mlcStatus" id="mlc" value="MLC">
                            <label class="form-check-label" for="mlc">MLC</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="mlcStatus" id="nonmlc" value="Non-MLC">
                            <label class="form-check-label" for="nonmlc">Non-MLC</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Third Row: Address, Hand Dominance, Affected Side -->
            <div class="row mt-3 align-items-center">  
                <!-- Address -->
                <div class="col-md-4">
                    <label for="add" class="form-label fw-bold">Address</label>
                    <input type="text" class="form-control" id="address">
                </div>
            
                <!-- Hand Dominance -->
                <div class="col-md-4">
                    <label class="form-label fw-bold">Hand Dominance</label>
                    <div class="d-flex justify-content-end pe-4">  
                        <div class="form-check me-3">
                            <input class="form-check-input" type="radio" name="hand" id="right" value="right">
                            <label class="form-check-label" for="right">Right</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="hand" id="left" value="left">
                            <label class="form-check-label" for="left">Left</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="hand" id="am" value="ambid">
                            <label class="form-check-label" for="am">Ambidextrous</label>
                        </div>
                    </div>
                </div>
            
                <!-- Affected Side -->
                 <!-- Affected Side Selection -->
    <div class="col-md-4">
        <label class="form-label fw-bold">Affected Side</label>
        <div class="d-flex pe-4">
            <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="side" id="left" value="left" onclick="updateDeformitySection()">
                <label class="form-check-label" for="left">Left</label>
            </div>
            <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="side" id="right" value="right" onclick="updateDeformitySection()">
                <label class="form-check-label" for="right">Right</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="side" id="both" value="both" onclick="updateDeformitySection()">
                <label class="form-check-label" for="both">Both</label>
            </div>
        </div>
            </div>
              
            <div class="row mb-3 align-items-center">
                <!-- Label -->
                <div class="col-md-4">
                    <label for="Dateofpresen" class="form-label fw-bold">Date of Presentation to KH Emergency/OPD:</label>
                </div>
                <!-- Input Field -->
                <div class="col-md-8">
                    <input type="date" class="form-control" id="dateofpresen">
                </div>
            </div>
            
            <div class="row mb-3 align-items-center">
                <!-- Label -->
                <div class="col-md-4">
                    <label for="Timeofarrival" class="form-label fw-bold">Time of Arrival to Trauma Center:</label>
                </div>
                <!-- Input Field -->
                <div class="col-md-8">
                    <input type="time" class="form-control" id="timearrival">
                </div>
            </div>
            <div class="container mt-3">
                <table class="table table-bordered">
                    <tbody>
                        <tr>
                            <td class="col-md-4"><label for="mechanism" class="form-label fw-bold">Mechanism of Injury:</label></td>
                            <td class="col-md-8"><input type="text" class="form-control" id="mechanism"></td>
                        </tr>
                        <tr>
                            <td class="col-md-4"><label for="timeInjury" class="form-label fw-bold">Time of Injury:</label></td>
                            <td class="col-md-8"><input type="text" class="form-control" id="timeInjury"></td>
                        </tr>
                        <tr>
                            <td class="col-md-4"><label for="dateInjury" class="form-label fw-bold">Date of Injury:</label></td>
                            <td class="col-md-8"><input type="text" class="form-control" id="dateInjury"></td>
                        </tr>
                        <tr>
                            <td class="col-md-4"><label for="placeInjury" class="form-label fw-bold">Place of Injury:</label></td>
                            <td class="col-md-8"><input type="text" class="form-control" id="placeInjury"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="row mb-3 align-items-center">
                <!-- Treatment for the same elsewhere -->
                <div class="col-md-8">
                    <label for="Treatment" class="form-label fw-bold">Treatment for the same elsewhere:</label>
                    <input type="text" class="form-control" id="treatment">
                </div>
            
                <!-- Tetanus prophylaxis received (Radio Buttons) -->
                <div class="col-md-4">
                    <label class="form-label fw-bold">Tetanus prophylaxis received:</label>
                    <div class="d-flex justify-content-end pe-4">
                        <div class="form-check me-3">
                            <input class="form-check-input" type="radio" name="tetanus" id="tetanusNo" value="no">
                            <label class="form-check-label" for="tetanusNo">No</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="tetanus" id="tetanusYes" value="yes">
                            <label class="form-check-label" for="tetanusYes">Yes</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mb-3 align-items-center">
                <!-- Label -->
                <div class="col-md-4">
                    <label for="refer" class="form-label fw-bold">Referred from/by:</label>
                </div>
                <!-- Input Field -->
                <div class="col-md-8">
                    <input type="text" class="form-control" id="refer">
                </div>
            </div>
            
            <div class="row mb-3 align-items-center">
                <!-- Label -->
                <div class="col-md-4">
                    <label for="Brought by" class="form-label fw-bold">Brought by:</label>
                </div>
                <!-- Input Field -->
                <div class="col-md-8">
                    <input type="text" class="form-control" id="brought">
                </div>
            </div>

               <div class="mb-3 row align-items-center">
                 <div class="col-md-4">
                     <label for="identification" class="form-label fw-bold">Identification marks 1.</label>
                 </div>
                 <div class="col-md-8">
                     <input type="text" class="form-control" id="iden">
                 </div>
             </div>
             <div class="mb-3 row align-items-center">
                 <div class="col-md-4">
                     <label for="mlc" class="form-label">(if MLC ) 2.</label>
                 </div>
                 <div class="col-md-8">
                     <input type="text" class="form-control" id="mlcif">
                 </div>
             </div>
             
             <div class="mb-3">
                <label class="form-label fw-bold">Comorbidities:</label>
                <div class="d-flex flex-wrap align-items-center">
                    <!-- NIL Checkbox -->
                    <div class="form-check me-3">
                        <input class="form-check-input" type="checkbox" id="nil" onclick="toggleNil(this)">
                        <label class="form-check-label" for="nil">NIL</label>
                    </div>
            
                    <!-- Other Comorbidities -->
                    <div id="otherComorbidities" class="d-flex flex-wrap">
                        <div class="form-check me-3">
                            <input class="form-check-input other-check" type="checkbox" id="dm">
                            <label class="form-check-label" for="dm">DM</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input other-check" type="checkbox" id="htn">
                            <label class="form-check-label" for="htn">HTN</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input other-check" type="checkbox" id="ihd">
                            <label class="form-check-label" for="ihd">IHD</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input other-check" type="checkbox" id="cva">
                            <label class="form-check-label" for="cva">CVA</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input other-check" type="checkbox" id="hypothyroid">
                            <label class="form-check-label" for="hypothyroid">Hypothyroid</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input other-check" type="checkbox" id="asthma">
                            <label class="form-check-label" for="asthma">Asthma</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input other-check" type="checkbox" id="tb">
                            <label class="form-check-label" for="tb">TB</label>
                        </div>
            
                        <!-- Other Checkbox & Textbox -->
                        <div class="form-check me-3 d-flex align-items-center">
                            <input class="form-check-input other-check" type="checkbox" id="others" onclick="toggleOtherTextBox()">
                            <label class="form-check-label me-2" for="others">Other not mentioned above</label>
                            <input type="text" class="form-control ms-2" id="otherTextBox" placeholder="Specify here" style="display: none; width: 200px;">
                        </div>
                    </div>
                </div>
            </div>
            
            <script>
                function toggleNil(nilCheckbox) {
                    let otherCheckboxes = document.querySelectorAll(".other-check");
                    let otherTextBox = document.getElementById("otherTextBox");
            
                    if (nilCheckbox.checked) {
                        // Disable and uncheck all other checkboxes
                        otherCheckboxes.forEach(checkbox => {
                            checkbox.checked = false;
                            checkbox.disabled = true;
                        });
                        otherTextBox.style.display = "none"; // Hide text box if open
                        otherTextBox.value = ""; // Clear input field
                    } else {
                        // Enable all checkboxes when "NIL" is unchecked
                        otherCheckboxes.forEach(checkbox => {
                            checkbox.disabled = false;
                        });
                    }
                }
            
                function toggleOtherTextBox() {
                    let otherCheckbox = document.getElementById("others");
                    let otherTextBox = document.getElementById("otherTextBox");
            
                    if (otherCheckbox.checked) {
                        otherTextBox.style.display = "inline-block"; // Show text box
                    } else {
                        otherTextBox.style.display = "none"; // Hide text box
                        otherTextBox.value = ""; // Clear input field
                    }
                }
            </script>
            
            <div class="container">
                <!-- History of Substance Abuse -->
                <div class="mb-4">
                    <label class="form-label fw-bold">History of Substance Abuse:</label>
                    <div class="d-flex flex-wrap align-items-center">
                        <!-- NIL Checkbox -->
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" id="substanceNil" onclick="toggleSubstanceNil(this)">
                            <label class="form-check-label" for="substanceNil">NIL</label>
                        </div>
            
                        <!-- Other Substance Abuse Options -->
                        <div id="substanceOptions" class="d-flex flex-wrap">
                            <div class="form-check me-3">
                                <input class="form-check-input substance-check" type="checkbox" id="smoking">
                                <label class="form-check-label" for="smoking">Smoking</label>
                            </div>
                            <div class="form-check me-3">
                                <input class="form-check-input substance-check" type="checkbox" id="alcohol">
                                <label class="form-check-label" for="alcohol">Alcohol</label>
                            </div>
                            <div class="form-check me-3">
                                <input class="form-check-input substance-check" type="checkbox" id="tobacco">
                                <label class="form-check-label" for="tobacco">Tobacco and its products</label>
                            </div>
                            <div class="form-check me-3">
                                <input class="form-check-input substance-check" type="checkbox" id="areca">
                                <label class="form-check-label" for="areca">Areca Nut</label>
                            </div>
            
                            <!-- Other Checkbox & Textbox -->
                            <div class="form-check me-3 d-flex align-items-center">
                                <input class="form-check-input substance-check" type="checkbox" id="substanceOther" onclick="toggleSubstanceTextBox()">
                                <label class="form-check-label me-2" for="substanceOther">Other</label>
                                <input type="text" class="form-control ms-2" id="substanceTextBox" placeholder="Specify here" style="display: none; width: 200px;">
                            </div>
                        </div>
                    </div>
                </div>
            
                <!-- E/o Substance Abuse at Presentation -->
<div class="mb-4 d-flex align-items-center">
    <label class="form-label fw-bold me-3">E/o substance abuse at presentation/incident:</label>
    
    <div class="form-check me-3">
        <input class="form-check-input" type="radio" name="eoSubstanceAbuse" id="eoYes" value="yes" onclick="toggleSubstanceTextBoxx()">
        <label class="form-check-label" for="eoYes">Yes</label>
    </div>
    
    <div id="substanceTextBoxContainer" class="ms-3" style="display: none;">
        <input type="text" class="form-control" id="substanceDetails" placeholder="Specify here" style="width: 200px;">
    </div>

    <div class="form-check ms-3">
        <input class="form-check-input" type="radio" name="eoSubstanceAbuse" id="eoNo" value="no" onclick="toggleSubstanceTextBoxx()" checked>
        <label class="form-check-label" for="eoNo">No</label>
    </div>
</div>

<script>
    function toggleSubstanceTextBoxx() {
        const yesOption = document.getElementById("eoYes");
        const textBoxContainer = document.getElementById("substanceTextBoxContainer");

        if (yesOption.checked) {
            textBoxContainer.style.display = "block";
        } else {
            textBoxContainer.style.display = "none";
            document.getElementById("substanceDetails").value = ""; // Clear input when hidden
        }
    }
</script>

            <script>
                function toggleSubstanceNil(nilCheckbox) {
                    let substanceCheckboxes = document.querySelectorAll(".substance-check");
                    let substanceTextBox = document.getElementById("substanceTextBox");
            
                    if (nilCheckbox.checked) {
                        // Disable and uncheck all other checkboxes
                        substanceCheckboxes.forEach(checkbox => {
                            checkbox.checked = false;
                            checkbox.disabled = true;
                        });
                        substanceTextBox.style.display = "none"; // Hide text box if open
                        substanceTextBox.value = ""; // Clear input field
                    } else {
                        // Enable all checkboxes when "NIL" is unchecked
                        substanceCheckboxes.forEach(checkbox => {
                            checkbox.disabled = false;
                        });
                    }
                }
            
                function toggleSubstanceTextBox() {
                    let otherCheckbox = document.getElementById("substanceOther");
                    let substanceTextBox = document.getElementById("substanceTextBox");
            
                    if (otherCheckbox.checked) {
                        substanceTextBox.style.display = "inline-block"; // Show text box
                    } else {
                        substanceTextBox.style.display = "none"; // Hide text box
                        substanceTextBox.value = ""; // Clear input field
                    }
                }
            </script></div>
            <hr style="border-top: 2px dotted black; width: 100%;">

             <div class="container mt-3">
                 <label class="form-label fw-bold">Deformities:</label>
                 <div id="deformityContainer"></div></div>
               <script>
                // Deformities options (with "None" first and "Other" last)
    const deformityOptions = [
        { id: "none", label: "None" },
        { id: "mallet", label: "Mallet" },
        { id: "flail-limb", label: "Flail limb" },
        { id: "finger-drop", label: "Finger drop" },
        { id: "thumb-drop", label: "Thumb drop" },
        { id: "wrist-drop", label: "Wrist drop" },
        { id: "claw-hand", label: "Claw hand" },
        { id: "pointing-index", label: "Pointing index" },
        { id: "ape-thumb", label: "Ape-thumb" },
        { id: "boutonniere", label: "Boutonniere" },
        { id: "swan-neck", label: "Swan-neck" },
        { id: "loss-of-finger-cascade", label: "Loss of finger cascade" },
        { id: "other", label: "Other" }
    ];

    function generateDeformityCheckboxes(hand) {
        let checkboxes = deformityOptions.map(opt => `
            <div class="form-check me-3">
                <input class="form-check-input deformity-check ${hand}-deformity" type="checkbox" id="${hand}-${opt.id}" onchange="handleDeformitySelection('${hand}')">
                <label class="form-check-label" for="${hand}-${opt.id}">${opt.label}</label>
            </div>
        `).join("");

        return `
            <div class="mb-3">
                <label class="form-label fw-bold">${hand.charAt(0).toUpperCase() + hand.slice(1)} Hand Deformities:</label>
                <div class="d-flex flex-wrap">${checkboxes}</div>
                <input type="text" class="form-control mt-2" id="${hand}-other-text" placeholder="Specify other deformity" style="display: none;">
            </div>
        `;
    }

    function updateDeformitySection() {
        let selectedSide = document.querySelector('input[name="side"]:checked').value;
        let deformityContainer = document.getElementById("deformityContainer");

        if (selectedSide === "both") {
            deformityContainer.innerHTML = `
                <div class="row">
                    <div class="col-md-6">${generateDeformityCheckboxes("left")}</div>
                    <div class="col-md-6">${generateDeformityCheckboxes("right")}</div>
                </div>
            `;
        } else {
            deformityContainer.innerHTML = generateDeformityCheckboxes(selectedSide);
        }
    }

    function handleDeformitySelection(hand) {
        let noneCheckbox = document.getElementById(`${hand}-none`);
        let otherCheckbox = document.getElementById(`${hand}-other`);
        let otherTextbox = document.getElementById(`${hand}-other-text`);
        let checkboxes = document.querySelectorAll(`.${hand}-deformity`);

        if (noneCheckbox.checked) {
            // Disable only the checkboxes of the same hand
            checkboxes.forEach(checkbox => {
                if (checkbox.id !== `${hand}-none`) {
                    checkbox.checked = false;
                    checkbox.disabled = true;
                }
            });
            otherTextbox.style.display = "none";
            otherTextbox.value = "";
        } else {
            // Enable checkboxes only for this hand
            checkboxes.forEach(checkbox => checkbox.disabled = false);

            // Show the text box only when "Other" is checked
            if (otherCheckbox.checked) {
                otherTextbox.style.display = "inline-block";
            } else {
                otherTextbox.style.display = "none";
                otherTextbox.value = "";
            }
        }
    }
            </script>
            <hr style="border-top: 2px dotted black; width: 100%;">

            <div class="container mt-3">
                <!-- Finger Amputation Selection -->
                <div class="d-flex align-items-center">
                    <label class="form-label fw-bold me-3">Finger Amputations:</label>
                    <div class="form-check me-3">
                        <input class="form-check-input" type="radio" name="finger_amputation" id="amputation_present" value="present" onclick="updateAmputationSection()">
                        <label class="form-check-label" for="amputation_present">Present</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="finger_amputation" id="amputation_absent" value="absent" onclick="updateAmputationSection()">
                        <label class="form-check-label" for="amputation_absent">Absent</label>
                    </div>
                </div>
            
                <!-- Amputation Selection Based on Affected Side -->
                <div id="amputationContainer" class="mt-3"></div>
            </div>

            <!-- Amputation Table -->
<div id="amputationTable" class="d-none mt-4">
    <div style="display: flex; justify-content: center; align-items: center;">
        <img src="http://localhost:8000/myimage1new.png" alt="selection" style="width: 500px; height: 250px;"></div>
    <table class="table table-bordered text-center" style="max-width: 900px; margin: 20px auto;">
        <thead>
            <tr>
                <th colspan="4" id="leftHeader">LEFT</th>
                <th colspan="4" id="rightHeader">RIGHT</th>
            </tr>
            <tr>
                <th class="table-left">Digit</th>
                <th class="table-left">Tamai</th>
                <th class="table-left">Allen</th>
                <th class="table-left">PNB</th>
                <th class="table-right">Digit</th>
                <th class="table-right">Tamai</th>
                <th class="table-right">Allen</th>
                <th class="table-right">PNB</th>
            </tr>
        </thead>
        <tbody id="tableRows"></tbody>
    </table>
</div>

<script>
    function generateFingerSelection(hand) {
        const fingers = ["Thumb", "Index", "Middle", "Ring", "Little"];
        return `
            <div class="mb-3">
                <label class="form-label fw-bold">${hand.charAt(0).toUpperCase() + hand.slice(1)} Hand Amputations:</label>
                <div class="d-flex flex-wrap">
                    ${fingers.map(finger => `
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" id="${hand}-${finger.toLowerCase()}" onchange="updateTable()">
                            <label class="form-check-label" for="${hand}-${finger.toLowerCase()}">${finger}</label>
                        </div>
                    `).join("")}
                </div>
            </div>
        `;
    }

    function updateAmputationSection() {
        let selectedSide = document.querySelector('input[name="side"]:checked')?.value;
        let amputationStatus = document.querySelector('input[name="finger_amputation"]:checked')?.value;
        let amputationContainer = document.getElementById("amputationContainer");

        if (amputationStatus === "present") {
            amputationContainer.innerHTML = selectedSide === "both" ?
                `<div class="row">
                    <div class="col-md-6">${generateFingerSelection("left")}</div>
                    <div class="col-md-6">${generateFingerSelection("right")}</div>
                </div>` : generateFingerSelection(selectedSide);
        } else {
            amputationContainer.innerHTML = "";
            document.getElementById("amputationTable").classList.add("d-none");
        }
        updateTable();
    }

    function updateTable() {
        let selectedFingers = document.querySelectorAll('#amputationContainer input[type="checkbox"]:checked');
        let tableContainer = document.getElementById("amputationTable");
        let tableRows = document.getElementById("tableRows");
        let leftHeader = document.getElementById("leftHeader");
        let rightHeader = document.getElementById("rightHeader");
        let leftColumns = document.querySelectorAll(".table-left");
        let rightColumns = document.querySelectorAll(".table-right");

        tableRows.innerHTML = "";
        let leftFingers = [], rightFingers = [];
        selectedFingers.forEach(finger => {
            let [hand, fingerName] = finger.id.split("-");
            (hand === "left" ? leftFingers : rightFingers).push(fingerName.charAt(0).toUpperCase() + fingerName.slice(1));
        });

        let selectedSide = document.querySelector('input[name="side"]:checked')?.value;
        if (leftFingers.length === 0 && rightFingers.length === 0) {
            tableContainer.classList.add("d-none");
            return;
        } else {
            tableContainer.classList.remove("d-none");
        }

        if (selectedSide === "left") {
            rightHeader.style.display = "none";
            leftHeader.style.display = "table-cell";
            rightColumns.forEach(col => col.style.display = "none");
            leftColumns.forEach(col => col.style.display = "table-cell");
        } else if (selectedSide === "right") {
            leftHeader.style.display = "none";
            rightHeader.style.display = "table-cell";
            leftColumns.forEach(col => col.style.display = "none");
            rightColumns.forEach(col => col.style.display = "table-cell");
        } else {
            leftHeader.style.display = "table-cell";
            rightHeader.style.display = "table-cell";
            leftColumns.forEach(col => col.style.display = "table-cell");
            rightColumns.forEach(col => col.style.display = "table-cell");
        }

        let maxRows = Math.max(leftFingers.length, rightFingers.length);
        for (let i = 0; i < maxRows; i++) {
            let leftDigit = leftFingers[i] || "";
            let rightDigit = rightFingers[i] || "";

            tableRows.innerHTML += `
                <tr>
                    ${selectedSide !== "right" ? `<td>${leftDigit}</td>${createDropdown()}${createDropdown()}<td><input type="text" class="form-control"></td>` : ""}
                    ${selectedSide !== "left" ? `<td>${rightDigit}</td>${createDropdown()}${createDropdown()}<td><input type="text" class="form-control"></td>` : ""}
                </tr>
            `;
        }
    }

    function createDropdown() {
        return `<td><select class="form-control"><option value="">Select</option><option value="Zone1">Zone1</option><option value="Zone2">Zone2</option><option value="Zone3">Zone3</option><option value="Zone4">Zone4</option></select></td>`;
    }
</script>
<hr style="border-top: 2px dotted black; width: 100%;">

<div class="mb-3">
    <label for="mark2" class="form-label fw-bold">
        Describe the wounds by SIZE, TYPE, and EXPOSED STRUCTURES and mark the same on the image:
    </label>
</div>


<div class="mb-3">
    <label class="form-label fw-bold">Select Hand:</label>
    <label class="me-3"><input type="radio" name="side" value="left" onclick="askSurface()"> Left</label>
    <label class="me-3"><input type="radio" name="side" value="right" onclick="askSurface()"> Right</label>
    <label><input type="radio" name="side" value="both" onclick="askSurface()"> Both</label>
</div>

<!-- Hand Surface Selection -->
<div id="surfaceSelection" class="hidden mb-3">
    <div class="surface-selection-container">
        <!-- Left hand surface selection (shown only when left or both is selected) -->
        <div id="leftSurfaceSelection" class="surface-option hidden">
            <h5>Left Hand</h5>
            <label class="me-3"><input type="radio" name="leftSurface" value="volar" onclick="updateImages()"> Volar</label>
            <label class="me-3"><input type="radio" name="leftSurface" value="dorsal" onclick="updateImages()"> Dorsal</label>
            <label><input type="radio" name="leftSurface" value="both" onclick="updateImages()"> Both</label>
        </div>

        <!-- Right hand surface selection (shown only when right or both is selected) -->
        <div id="rightSurfaceSelection" class="surface-option hidden">
            <h5>Right Hand</h5>
            <label class="me-3"><input type="radio" name="rightSurface" value="volar" onclick="updateImages()"> Volar</label>
            <label class="me-3"><input type="radio" name="rightSurface" value="dorsal" onclick="updateImages()"> Dorsal</label>
            <label><input type="radio" name="rightSurface" value="both" onclick="updateImages()"> Both</label>
        </div>
    </div>
</div>

<!-- Wound Type Selection -->
<div class="mb-3">
    <label class="form-label fw-bold">Select Wound Type(s):</label>
    <div class="wound-type-container">
        <div class="form-check me-3">
            <input class="form-check-input wound-type-checkbox" type="checkbox" name="woundType" id="laceration" value="Laceration" onchange="updateWoundDetails()">
            <label class="form-check-label wound-type-label" for="laceration">
                <span class="color-indicator" style="background-color: #FF0000;"></span>
                Laceration
            </label>
        </div>
        <div class="form-check me-3">
            <input class="form-check-input wound-type-checkbox" type="checkbox" name="woundType" id="contusion" value="Contusion" onchange="updateWoundDetails()">
            <label class="form-check-label wound-type-label" for="contusion">
                <span class="color-indicator" style="background-color: #0000FF;"></span>
                Contusion
            </label>
        </div>
        <div class="form-check me-3">
            <input class="form-check-input wound-type-checkbox" type="checkbox" name="woundType" id="avulsion" value="Avulsion" onchange="updateWoundDetails()">
            <label class="form-check-label wound-type-label" for="avulsion">
                <span class="color-indicator" style="background-color: #008000;"></span>
                Avulsion
            </label>
        </div>
        <div class="form-check me-3">
            <input class="form-check-input wound-type-checkbox" type="checkbox" name="woundType" id="incised" value="Incised" onchange="updateWoundDetails()">
            <label class="form-check-label wound-type-label" for="incised">
                <span class="color-indicator" style="background-color: #800080;"></span>
                Incised
            </label>
        </div>
        <div class="form-check me-3">
            <input class="form-check-input wound-type-checkbox" type="checkbox" name="woundType" id="abrasion" value="Abrasion" onchange="updateWoundDetails()">
            <label class="form-check-label wound-type-label" for="abrasion">
                <span class="color-indicator" style="background-color: #FFA500;"></span>
                Abrasion
            </label>
        </div>
        <div class="form-check me-3">
            <input class="form-check-input wound-type-checkbox" type="checkbox" name="woundType" id="penetrating" value="Penetrating" onchange="updateWoundDetails()">
            <label class="form-check-label wound-type-label" for="penetrating">
                <span class="color-indicator" style="background-color: #FF00FF;"></span>
                Penetrating
            </label>
        </div>
        <div class="form-check me-3">
            <input class="form-check-input wound-type-checkbox" type="checkbox" name="woundType" id="degloving" value="Degloving" onchange="updateWoundDetails()">
            <label class="form-check-label wound-type-label" for="degloving">
                <span class="color-indicator" style="background-color: #000000;"></span>
                Degloving
            </label>
        </div>
        <div class="form-check me-3">
            <input class="form-check-input wound-type-checkbox" type="checkbox" name="woundType" id="crush" value="Crush" onchange="updateWoundDetails()">
            <label class="form-check-label wound-type-label" for="crush">
                <span class="color-indicator" style="background-color: #8B4513;"></span>
                Crush
            </label>
        </div>
    </div>
</div>

<!-- Active Wound Type for Drawing -->
<div id="activeWoundTypeContainer" class="mb-3 hidden">
    <label class="form-label fw-bold">Active Wound Type for Drawing:</label>
    <select id="activeWoundType" class="form-select">
        <!-- Options will be populated dynamically based on selected wound types -->
    </select>
</div>

<!-- Line Style Selection -->
<div class="mb-3">
    <label class="form-label fw-bold">Line Style:</label>
    <div class="d-flex">
        <div class="form-check me-3">
            <input class="form-check-input" type="radio" name="lineStyle" id="freehand" value="freehand" checked>
            <label class="form-check-label" for="freehand">Freehand</label>
        </div>
        <div class="form-check me-3">
            <input class="form-check-input" type="radio" name="lineStyle" id="straight" value="straight">
            <label class="form-check-label" for="straight">Straight</label>
        </div>
    </div>
</div>

<!-- Image and Canvas Container -->
<div id="imageContainer" class="hidden">
    <div class="hands-container">
        <div id="leftCanvasContainer" class="hand-section hidden">
            <div class="hand-content">
                <div class="image-wrapper">
                    <img id="leftImage" alt="Left Hand">
                    <canvas id="leftCanvas"></canvas>
                </div>
                <div id="leftWoundDetails" class="wound-details">
                    <div class="no-wounds-message">No wound types selected</div>
                </div>
            </div>
        </div>

        <div id="rightCanvasContainer" class="hand-section hidden">
            <div class="hand-content">
                <div class="image-wrapper">
                    <img id="rightImage" alt="Right Hand">
                    <canvas id="rightCanvas"></canvas>
                </div>
                <div id="rightWoundDetails" class="wound-details">
                    <div class="no-wounds-message">No wound types selected</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Drawing variables
    let isDrawing = false;
    let startX, startY;
    let activeCanvas, activeContext;
    let activeSide;
    
    // Drawing history for undo functionality
    let drawingHistory = {
        left: [],
        right: []
    };
    
    // Color mapping for wound types
    const woundColors = {
        'Laceration': '#FF0000',     // Red
        'Contusion': '#0000FF',      // Blue
        'Avulsion': '#008000',       // Green
        'Incised': '#800080',        // Purple
        'Abrasion': '#FFA500',       // Orange
        'Penetrating': '#FF00FF',    // Magenta
        'Degloving': '#000000',      // Black
        'Crush': '#8B4513'           // Brown
    };
    
    function askSurface() {
        const selectedSide = document.querySelector('input[name="side"]:checked').value;
        const surfaceSelection = document.getElementById("surfaceSelection");
        const leftSurfaceSelection = document.getElementById("leftSurfaceSelection");
        const rightSurfaceSelection = document.getElementById("rightSurfaceSelection");
        
        // Reset and hide all surface selections
        surfaceSelection.classList.remove("hidden");
        leftSurfaceSelection.classList.add("hidden");
        rightSurfaceSelection.classList.add("hidden");
        
        // Show appropriate surface selection based on hand selection
        if (selectedSide === "left" || selectedSide === "both") {
            leftSurfaceSelection.classList.remove("hidden");
        }
        
        if (selectedSide === "right" || selectedSide === "both") {
            rightSurfaceSelection.classList.remove("hidden");
        }
    }

    function updateImages() {
        const selectedSide = document.querySelector('input[name="side"]:checked').value;
        const imageContainer = document.getElementById("imageContainer");
        const leftContainer = document.getElementById("leftCanvasContainer");
        const rightContainer = document.getElementById("rightCanvasContainer");

        // Hide containers initially
        leftContainer.classList.add("hidden");
        rightContainer.classList.add("hidden");
        imageContainer.classList.remove("hidden");

        // Check if surfaces are selected
        const leftSurfaceSelected = document.querySelector('input[name="leftSurface"]:checked');
        const rightSurfaceSelected = document.querySelector('input[name="rightSurface"]:checked');
        
        // Only proceed if required surfaces are selected
        if ((selectedSide === "left" && !leftSurfaceSelected) || 
            (selectedSide === "right" && !rightSurfaceSelected) ||
            (selectedSide === "both" && (!leftSurfaceSelected || !rightSurfaceSelected))) {
            return;
        }

        // Set up left hand if selected
        if (selectedSide === "left" || selectedSide === "both") {
            const leftSurface = document.querySelector('input[name="leftSurface"]:checked').value;
            leftContainer.classList.remove("hidden");
            
            let leftImageSrc;
            if (leftSurface === "volar") {
                leftImageSrc = "http://localhost:8000/volarleft.png";
            } else if (leftSurface === "dorsal") {
                leftImageSrc = "http://localhost:8000/dorsalleft.png";
            } else { // both
                leftImageSrc = "http://localhost:8000/left1.png";
            }
            
            document.getElementById("leftImage").src = leftImageSrc;
            setupCanvas("leftCanvas", "leftImage", "left");
        }
        
        // Set up right hand if selected
        if (selectedSide === "right" || selectedSide === "both") {
            const rightSurface = document.querySelector('input[name="rightSurface"]:checked').value;
            rightContainer.classList.remove("hidden");
            
            let rightImageSrc;
            if (rightSurface === "volar") {
                rightImageSrc = "http://localhost:8000/volarright.png";
            } else if (rightSurface === "dorsal") {
                rightImageSrc = "http://localhost:8000/dorsalleft.png";
            } else { // both
                rightImageSrc = "http://localhost:8000/right1.png";
            }
            
            document.getElementById("rightImage").src = rightImageSrc;
            setupCanvas("rightCanvas", "rightImage", "right");
        }

        updateWoundDetails();
        
        // Reset drawing history for new images
        drawingHistory = {
            left: [],
            right: []
        };
    }

    function getSelectedWoundTypes() {
        const checkboxes = document.querySelectorAll('input[name="woundType"]:checked');
        return Array.from(checkboxes).map(checkbox => checkbox.value);
    }

    function updateActiveWoundTypeDropdown() {
        const selectedWoundTypes = getSelectedWoundTypes();
        const activeWoundTypeContainer = document.getElementById('activeWoundTypeContainer');
        const activeWoundTypeSelect = document.getElementById('activeWoundType');
        
        activeWoundTypeSelect.innerHTML = '';
        
        if (selectedWoundTypes.length > 0) {
            activeWoundTypeContainer.classList.remove('hidden');
            
            selectedWoundTypes.forEach(woundType => {
                const option = document.createElement('option');
                option.value = woundType;
                option.textContent = woundType;
                activeWoundTypeSelect.appendChild(option);
            });
        } else {
            activeWoundTypeContainer.classList.add('hidden');
        }
    }

    function updateWoundDetails() {
        const selectedSide = document.querySelector('input[name="side"]:checked')?.value;
        
        // If hand isn't selected yet, exit early
        if (!selectedSide) return;
        
        const selectedWoundTypes = getSelectedWoundTypes();
        
        const leftDetails = document.getElementById('leftWoundDetails');
        const rightDetails = document.getElementById('rightWoundDetails');
        
        leftDetails.innerHTML = '';
        rightDetails.innerHTML = '';
        
        // Update the active wound type dropdown
        updateActiveWoundTypeDropdown();
        
        if (selectedWoundTypes.length === 0) {
            const noWoundsMessage = '<div class="no-wounds-message">No wound types selected</div>';
            if (selectedSide === 'left' || selectedSide === 'both') {
                leftDetails.innerHTML = noWoundsMessage;
            }
            if (selectedSide === 'right' || selectedSide === 'both') {
                rightDetails.innerHTML = noWoundsMessage;
            }
            return;
        }
        
        // Create input forms for each selected wound type
        selectedWoundTypes.forEach(woundType => {
            // For left hand
            if (selectedSide === 'left' || selectedSide === 'both') {
                const leftSurface = document.querySelector('input[name="leftSurface"]:checked')?.value;
                if (leftSurface) {
                    const woundInputsHTML = createWoundInputs(woundType, leftSurface);
                    leftDetails.innerHTML += woundInputsHTML;
                }
            }
            
            // For right hand
            if (selectedSide === 'right' || selectedSide === 'both') {
                const rightSurface = document.querySelector('input[name="rightSurface"]:checked')?.value;
                if (rightSurface) {
                    const woundInputsHTML = createWoundInputs(woundType, rightSurface);
                    rightDetails.innerHTML += woundInputsHTML;
                }
            }
        });
    }

    function createWoundInputs(woundType, surface) {
        const woundColor = woundColors[woundType];
        
        let volarFields = `
            <div class="fields-container">
                <div class="field-group">
                    <label>Size (mm):</label>
                    <input type="number" class="form-control" name="${woundType}-volar-length">
                </div>
                <div class="field-group">
                    <label>Volar Length (mm):</label>
                    <input type="number" class="form-control" name="${woundType}-volar-width">
                </div>
                <div class="field-group">
                    <label>Volar Width (mm):</label>
                    <input type="number" class="form-control" name="${woundType}-volar-depth">
                </div>
            </div>
        `;

        let dorsalFields = `
            <div class="fields-container">
                <div class="field-group">
                    <label>Size (mm):</label>
                    <input type="number" class="form-control" name="${woundType}-dorsal-length">
                </div>
                <div class="field-group">
                    <label>Dorsal Length (mm):</label>
                    <input type="number" class="form-control" name="${woundType}-dorsal-width">
                </div>
                <div class="field-group">
                    <label>Dorsal Width (mm):</label>
                    <input type="number" class="form-control" name="${woundType}-dorsal-depth">
                </div>
            </div>
        `;

        return `<div class="wound-input-group" id="${woundType}-details">
            <h5>${woundType}</h5>
            <div style="border-left: 4px solid ${woundColor}; padding-left: 10px;">
                ${(surface === "volar" || surface === "both") ? volarFields : ''}
                ${(surface === "dorsal" || surface === "both") ? dorsalFields : ''}
                <div class="mb-2">
                    <label>Notes:</label>
                    <textarea class="form-control" rows="2" name="${woundType}-notes"></textarea>
                </div>
            </div>
        </div>`;
    }

    function setupCanvas(canvasId, imageId, side) {
        const canvas = document.getElementById(canvasId);
        const image = document.getElementById(imageId);
        
        // Wait for image to load before setting canvas dimensions
        if (image.complete) {
            setCanvasDimensions();
        } else {
            image.onload = setCanvasDimensions;
        }
        
        function setCanvasDimensions() {
            canvas.width = image.width;
            canvas.height = image.height;
            
            const ctx = canvas.getContext("2d");
            ctx.lineWidth = 2;
            ctx.lineCap = "round";
            ctx.lineJoin = "round";
        }
        
        // Remove any previous event listeners
        canvas.removeEventListener('mousedown', startDrawing);
        canvas.removeEventListener('mousemove', draw);
        canvas.removeEventListener('mouseup', stopDrawing);
        canvas.removeEventListener('mouseout', stopDrawing);
        canvas.removeEventListener('touchstart', handleTouchStart);
        canvas.removeEventListener('touchmove', handleTouchMove);
        canvas.removeEventListener('touchend', handleTouchEnd);
        
        // Add event listeners for drawing
        canvas.addEventListener('mousedown', function(e) {
            startDrawing(e, side);
        });
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        
        // Touch support
        canvas.addEventListener('touchstart', function(e) {
            handleTouchStart(e, side);
        });
        canvas.addEventListener('touchmove', handleTouchMove);
        canvas.addEventListener('touchend', handleTouchEnd);
    }
    
    function startDrawing(e, side) {
        const selectedWoundTypes = getSelectedWoundTypes();
        if (selectedWoundTypes.length === 0) {
            alert("Please select at least one wound type before drawing.");
            return;
        }
        
        isDrawing = true;
        activeCanvas = e.target;
        activeContext = activeCanvas.getContext('2d');
        activeSide = side;
        
        const rect = activeCanvas.getBoundingClientRect();
        startX = e.clientX - rect.left;
        startY = e.clientY - rect.top;
        
        // Get the active wound type for drawing from the dropdown
        const activeWoundTypeSelect = document.getElementById('activeWoundType');
        const selectedWoundType = activeWoundTypeSelect.value;
        
        // Set color based on selected wound type
        activeContext.strokeStyle = woundColors[selectedWoundType];
        
        // Start a new path
        activeContext.beginPath();
        activeContext.moveTo(startX, startY);
        
        // Create a new drawing for history
        const newDrawing = {
            type: selectedWoundType,
            color: woundColors[selectedWoundType],
            points: [{x: startX, y: startY}],
            lineStyle: document.querySelector('input[name="lineStyle"]:checked').value,
            time: Date.now()
        };
        
        // Save the current canvas state
        const currentState = activeContext.getImageData(0, 0, activeCanvas.width, activeCanvas.height);
        newDrawing.previousState = currentState;
        
        // Add to history
        drawingHistory[activeSide].push(newDrawing);
    }
    
    function draw(e) {
        if (!isDrawing) return;
        
        const rect = activeCanvas.getBoundingClientRect();
        const currentX = e.clientX - rect.left;
        const currentY = e.clientY - rect.top;
        
        const lineStyle = document.querySelector('input[name="lineStyle"]:checked').value;
        
        if (lineStyle === 'freehand') {
            // Draw freehand line
            activeContext.lineTo(currentX, currentY);
            activeContext.stroke();
            
            // Update the current drawing in history
            const currentDrawing = drawingHistory[activeSide][drawingHistory[activeSide].length - 1];
            currentDrawing.points.push({x: currentX, y: currentY});
        } else if (lineStyle === 'straight') {
            // Draw straight line (clear and redraw from start to current)
            const currentDrawing = drawingHistory[activeSide][drawingHistory[activeSide].length - 1];
            
            // Restore previous state
            activeContext.putImageData(currentDrawing.previousState, 0, 0);
            
            // Draw new line
            activeContext.beginPath();
            activeContext.moveTo(startX, startY);
            activeContext.lineTo(currentX, currentY);
            activeContext.stroke();
            
            // Update points (just keep start and current for straight line)
            currentDrawing.points = [{x: startX, y: startY}, {x: currentX, y: currentY}];
        }
    }
    
    function stopDrawing() {
        isDrawing = false;
    }
    
    // Touch event handlers
    function handleTouchStart(e, side) {
        e.preventDefault();
        if (e.touches.length === 1) {
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            activeCanvas = e.target;
            startDrawing(mouseEvent, side);
        }
    }
    
    function handleTouchMove(e) {
        e.preventDefault();
        if (e.touches.length === 1 && isDrawing) {
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            draw(mouseEvent);
        }
    }
    
    function handleTouchEnd(e) {
        e.preventDefault();
        stopDrawing();
    }
    
    function clearCanvas() {
        // Clear all canvases
        const canvases = document.querySelectorAll('canvas');
        canvases.forEach(canvas => {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });
        
        // Reset history
        drawingHistory = {
            left: [],
            right: []
        };
    }
    
    function undoLastMark() {
        // Get active side (use left if both are showing)
        const selectedSide = document.querySelector('input[name="side"]:checked').value;
        let sideToUndo;
        
        if (selectedSide === 'both') {
            // If both sides are showing, determine which has the most recent drawing
            if (drawingHistory.left.length > 0 && drawingHistory.right.length > 0) {
                // Undo the most recently edited side
                const leftLastTime = drawingHistory.left[drawingHistory.left.length - 1].time || 0;
                const rightLastTime = drawingHistory.right[drawingHistory.right.length - 1].time || 0;
                sideToUndo = leftLastTime > rightLastTime ? 'left' : 'right';
            } else {
                // Undo the side that has drawings
                sideToUndo = drawingHistory.left.length > 0 ? 'left' : 'right';
            }
        } else {
            sideToUndo = selectedSide;
        }
        
        if (drawingHistory[sideToUndo].length > 0) {
            // Remove the last drawing
            const lastDrawing = drawingHistory[sideToUndo].pop();
            
            // Get the canvas
            const canvasId = sideToUndo === 'left' ? 'leftCanvas' : 'rightCanvas';
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // Restore previous state if available, otherwise clear
            if (lastDrawing.previousState) {
                ctx.putImageData(lastDrawing.previousState, 0, 0);
            } else {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                // Redraw all remaining items
                redrawCanvas(sideToUndo);
            }
        }
    }
    
    function redrawCanvas(side) {
        const canvasId = side === 'left' ? 'leftCanvas' : 'rightCanvas';
        const canvas = document.getElementById(canvasId);
        const ctx = canvas.getContext('2d');
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Redraw all items in history
        drawingHistory[side].forEach(drawing => {
            ctx.strokeStyle = drawing.color;
            ctx.beginPath();
            
            if (drawing.points.length > 0) {
                ctx.moveTo(drawing.points[0].x, drawing.points[0].y);
                
                if (drawing.lineStyle === 'straight' && drawing.points.length > 1) {
                    // For straight lines, just draw from start to end
                    const endPoint = drawing.points[drawing.points.length - 1];
                    ctx.lineTo(endPoint.x, endPoint.y);
                } else {
                    // For freehand, draw through all points
                    for (let i = 1; i < drawing.points.length; i++) {
                        ctx.lineTo(drawing.points[i].x, drawing.points[i].y);
                    }
                }
                
                ctx.stroke();
            }
        });
    }
// Ensure jsPDF is available globally
window.jsPDF = window.jspdf.jsPDF;

// Function to convert canvas drawings to images
async function replaceCanvasWithImage() {
    const canvasElements = document.querySelectorAll("canvas");

    canvasElements.forEach((canvas) => {
        const img = new Image();
        img.src = canvas.toDataURL("image/png");  // Convert canvas to image

        img.style.width = canvas.style.width;   // Maintain same size
        img.style.height = canvas.style.height;
        
        img.className = canvas.className;        // Preserve classes

        canvas.parentNode.replaceChild(img, canvas);  // Replace canvas with image
    });
}


</script>
<hr style="border-top: 2px dotted black; width: 100%;">

<div class="forearm-container">
    <label for="forearm-injury-radio-yes" class="form-label fw-bold">Forearm injuries:</label>
    <label>
        <input type="radio" id="forearm-injury-radio-yes" name="forearm-injury" value="yes" onclick="toggleForearmHandSelection(true)"> Yes
    </label>
    <label>
        <input type="radio" id="forearm-injury-radio-no" name="forearm-injury" value="no" onclick="toggleForearmHandSelection(false)"> No
    </label>
    
    <div id="forearm-hand-selection" style="display: none;">
        <label for="forearm-hand-select" class="form-label fw-bold">Select Hand:</label>
        <select id="forearm-hand-select" onchange="showForearmHandImage()">
            <option value="">--Select--</option>
            <option value="left">Left Hand</option>
            <option value="right">Right Hand</option>
            <option value="both">Both Hands</option>
        </select>
    </div>
    
    <div class="forearm-wound-selection">
        <label class="form-label fw-bold">Select Wound Type(s):</label>
        <div id="forearm-wound-checkboxes">
            <label><input type="checkbox" id="forearm-wound-laceration" name="forearm-wound" value="red" data-wound-name="Laceration" onclick="updateWoundPanels()"> <span style="color: red;"></span> Laceration</label>
            <label><input type="checkbox" id="forearm-wound-contusion" name="forearm-wound" value="blue" data-wound-name="Contusion" onclick="updateWoundPanels()"> <span style="color: blue;"></span> Contusion</label>
            <label><input type="checkbox" id="forearm-wound-avulsion" name="forearm-wound" value="green" data-wound-name="Avulsion" onclick="updateWoundPanels()"> <span style="color: green;"></span> Avulsion</label>
            <label><input type="checkbox" id="forearm-wound-incised" name="forearm-wound" value="purple" data-wound-name="Incised" onclick="updateWoundPanels()"> <span style="color: purple;"></span> Incised</label>
            <label><input type="checkbox" id="forearm-wound-abrasion" name="forearm-wound" value="orange" data-wound-name="Abrasion" onclick="updateWoundPanels()"> <span style="color: orange;"></span> Abrasion</label>
            <label><input type="checkbox" id="forearm-wound-penetrating" name="forearm-wound" value="pink" data-wound-name="Penetrating" onclick="updateWoundPanels()"> <span style="color: pink;"></span> Penetrating</label>
            <label><input type="checkbox" id="forearm-wound-degloving" name="forearm-wound" value="black" data-wound-name="Degloving" onclick="updateWoundPanels()"> <span style="color: black;"></span> Degloving</label>
            <label><input type="checkbox" id="forearm-wound-crush" name="forearm-wound" value="brown" data-wound-name="Crush" onclick="updateWoundPanels()"> <span style="color: brown;"></span> Crush</label>
        </div>
    </div>
    
    <div class="forearm-hands-section">
        <!-- Left Hand Section -->
        <div class="forearm-hand-section-wrapper">
            <div class="forearm-hand-container">
                <img id="forearm-left-hand-img" class="forearm-hand-image" src="http://localhost:8000/left2.png" alt="Left Hand" onload="adjustForearmCanvasSize('forearm-canvas-left', this)">
                <canvas id="forearm-canvas-left" class="forearm-hand-canvas"></canvas>
            </div>
            
            <div id="forearm-left-upload-section" class="forearm-upload-section" style="display: none;">
                <div class="forearm-upload-controls">
                    <h4>Upload Left Hand Image:</h4>
                    <input type="file" id="forearm-left-upload" accept="image/*" onchange="handleForearmImageUpload('left')">
                </div>
                <div class="forearm-uploaded-image-container">
                    <img id="forearm-left-uploaded-image" class="forearm-uploaded-image" style="display: none;">
                </div>
            </div>
        </div>
        
        <!-- Right Hand Section -->
        <div class="forearm-hand-section-wrapper">
            <div class="forearm-hand-container">
                <img id="forearm-right-hand-img" class="forearm-hand-image" src="http://localhost:8000/right2.png" alt="Right Hand" onload="adjustForearmCanvasSize('forearm-canvas-right', this)">
                <canvas id="forearm-canvas-right" class="forearm-hand-canvas"></canvas>
            </div>
            
            <div id="forearm-right-upload-section" class="forearm-upload-section" style="display: none;">
                <div class="forearm-upload-controls">
                    <h4>Upload Right Hand Image:</h4>
                    <input type="file" id="forearm-right-upload" accept="image/*" onchange="handleForearmImageUpload('right')">
                </div>
                <div class="forearm-uploaded-image-container">
                    <img id="forearm-right-uploaded-image" class="forearm-uploaded-image" style="display: none;">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Measurement sections for each hand -->
    <div class="forearm-measurement-sections">
        <div id="forearm-left-hand-section" class="forearm-hand-section">
            <div class="forearm-hand-section-title">LEFT HAND MEASUREMENTS</div>
            <div id="forearm-left-hand-panels" class="forearm-measurement-panels-container">
                <!-- Left hand measurement panels will be added here -->
            </div>
        </div>
        
        <div id="forearm-right-hand-section" class="forearm-hand-section">
            <div class="forearm-hand-section-title">RIGHT HAND MEASUREMENTS</div>
            <div id="forearm-right-hand-panels" class="forearm-measurement-panels-container">
                <!-- Right hand measurement panels will be added here -->
            </div>
        </div>
    </div>
</div>

<script>
    // Store measurements for each wound type and hand
    let forearmWoundMeasurements = {
        left: {},
        right: {}
    };
    
    function toggleForearmHandSelection(show) {
        document.getElementById('forearm-hand-selection').style.display = show ? 'block' : 'none';
        document.getElementById('forearm-left-hand-img').style.display = 'none';
        document.getElementById('forearm-right-hand-img').style.display = 'none';
        document.getElementById('forearm-canvas-left').style.display = 'none';
        document.getElementById('forearm-canvas-right').style.display = 'none';
        document.getElementById('forearm-left-upload-section').style.display = 'none';
        document.getElementById('forearm-right-upload-section').style.display = 'none';
        
        // Hide the measurement sections
        document.getElementById('forearm-left-hand-section').style.display = 'none';
        document.getElementById('forearm-right-hand-section').style.display = 'none';
        
        // Reset wound checkboxes when toggling off
        if (!show) {
            let checkboxes = document.querySelectorAll('input[name="forearm-wound"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
        }
    }

    function showForearmHandImage() {
        let selectedHand = document.getElementById('forearm-hand-select').value;
        
        // Hide all hand images and canvases
        document.getElementById('forearm-left-hand-img').style.display = 'none';
        document.getElementById('forearm-right-hand-img').style.display = 'none';
        document.getElementById('forearm-canvas-left').style.display = 'none';
        document.getElementById('forearm-canvas-right').style.display = 'none';
        document.getElementById('forearm-left-upload-section').style.display = 'none';
        document.getElementById('forearm-right-upload-section').style.display = 'none';
        
        // Hide all measurement sections
        document.getElementById('forearm-left-hand-section').style.display = 'none';
        document.getElementById('forearm-right-hand-section').style.display = 'none';

        // Show appropriate hand images and measurement sections based on selection
        if (selectedHand === 'left' || selectedHand === 'both') {
            document.getElementById('forearm-left-hand-img').style.display = 'block';
            document.getElementById('forearm-canvas-left').style.display = 'block';
            document.getElementById('forearm-left-hand-section').style.display = 'block';
            document.getElementById('forearm-left-upload-section').style.display = 'block';
        }
        
        if (selectedHand === 'right' || selectedHand === 'both') {
            document.getElementById('forearm-right-hand-img').style.display = 'block';
            document.getElementById('forearm-canvas-right').style.display = 'block';
            document.getElementById('forearm-right-hand-section').style.display = 'block';
            document.getElementById('forearm-right-upload-section').style.display = 'block';
        }
        
        // Update the wound panels based on the selected checkboxes
        updateWoundPanels();
    }

    function handleForearmImageUpload(hand) {
    const inputElement = document.getElementById(`forearm-${hand}-upload`);
    const imageElement = document.getElementById(`forearm-${hand}-uploaded-image`);
    
    if (inputElement.files && inputElement.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            imageElement.src = e.target.result;
            imageElement.style.display = 'block';
        };
        
        reader.readAsDataURL(inputElement.files[0]);
    }
}

    function adjustForearmCanvasSize(canvasId, imgElement) {
        let canvas = document.getElementById(canvasId);
        canvas.width = imgElement.width;
        canvas.height = imgElement.height;
        enableForearmFreehandDrawing(canvas);
    }

    function updateWoundPanels() {
        // Get selected hand and wound types
        let selectedHand = document.getElementById('forearm-hand-select').value;
        let checkedWounds = document.querySelectorAll('input[name="forearm-wound"]:checked');
        
        // Clear existing panels
        document.getElementById('forearm-left-hand-panels').innerHTML = '';
        document.getElementById('forearm-right-hand-panels').innerHTML = '';
        
        // If no hand is selected, don't add any panels
        if (!selectedHand) return;
        
        // For each checked wound type, create panels for the appropriate hand(s)
        checkedWounds.forEach(wound => {
            let woundValue = wound.value;
            let woundName = wound.dataset.woundName;
            
            if (selectedHand === 'left' || selectedHand === 'both') {
                createForearmWoundPanel('left', woundValue, woundName);
            }
            
            if (selectedHand === 'right' || selectedHand === 'both') {
                createForearmWoundPanel('right', woundValue, woundName);
            }
        });
    }
    
    function createForearmWoundPanel(hand, woundValue, woundName) {
        let panelId = `forearm-panel-${hand}-${woundValue}`;
    let containerSelector = `#forearm-${hand}-hand-panels`;
    let container = document.querySelector(containerSelector);
        
        // Create panel
        let panel = document.createElement('div');
        panel.id = panelId;
        panel.className = 'forearm-measurement-panel';
        
        // Create panel header with color indicator
        let header = document.createElement('h4');
        let colorIndicator = document.createElement('span');
        colorIndicator.className = 'forearm-wound-color-indicator';
        colorIndicator.style.backgroundColor = woundValue;
        header.appendChild(colorIndicator);
        header.appendChild(document.createTextNode(woundName));
        
        // Create container for measurement fields
        let fieldsContainer = document.createElement('div');
        fieldsContainer.className = 'forearm-measurement-fields-container';
        
        // Create measurement fields
        let sizeField = createForearmMeasurementField(`forearm-size-${hand}-${woundValue}`, 'Size (cm):', 'number');
        let lengthField = createForearmMeasurementField(`forearm-length-${hand}-${woundValue}`, 'Length (cm):', 'number');
        let breadthField = createForearmMeasurementField(`forearm-breadth-${hand}-${woundValue}`, 'Breadth (cm):', 'number');
        
        // Add fields to container
    fieldsContainer.appendChild(sizeField);
    fieldsContainer.appendChild(lengthField);
    fieldsContainer.appendChild(breadthField);
    
    // Create save button
    let saveButton = document.createElement('button');
    saveButton.id = `forearm-save-btn-${hand}-${woundValue}`;
    saveButton.textContent = 'Save Measurements';
    saveButton.className = 'btn btn-primary';
    saveButton.onclick = function() { saveForearmMeasurements(hand, woundValue); };
    
    // Add all elements to panel
    panel.appendChild(header);
    panel.appendChild(fieldsContainer);
    panel.appendChild(saveButton);
    
    // Add panel to container
    container.appendChild(panel);
    
    // Load saved measurements if available
    loadForearmMeasurements(hand, woundValue);
}

function createForearmMeasurementField(id, labelText, type) {
    let fieldDiv = document.createElement('div');
    fieldDiv.className = 'forearm-measurement-field';
    
    let label = document.createElement('label');
    label.htmlFor = id;
    label.textContent = labelText;
    
    let input = document.createElement('input');
    input.type = type;
    input.id = id;
    input.name = id;
    if (type === 'number') {
        input.step = '0.1';
        input.min = '0';
    }
    
    fieldDiv.appendChild(label);
    fieldDiv.appendChild(input);
    
    return fieldDiv;
}

function saveForearmMeasurements(hand, woundValue) {
    if (!forearmWoundMeasurements[hand]) {
        forearmWoundMeasurements[hand] = {};
    }
    
    forearmWoundMeasurements[hand][woundValue] = {
        size: document.getElementById(`forearm-size-${hand}-${woundValue}`).value,
        length: document.getElementById(`forearm-length-${hand}-${woundValue}`).value,
        breadth: document.getElementById(`forearm-breadth-${hand}-${woundValue}`).value
    };
    
    alert(`${hand.charAt(0).toUpperCase() + hand.slice(1)} hand ${document.querySelector(`input[value="${woundValue}"]`).dataset.woundName} measurements saved successfully!`);
}

function loadForearmMeasurements(hand, woundValue) {
    if (forearmWoundMeasurements[hand] && forearmWoundMeasurements[hand][woundValue]) {
        document.getElementById(`forearm-size-${hand}-${woundValue}`).value = forearmWoundMeasurements[hand][woundValue].size || '';
        document.getElementById(`forearm-length-${hand}-${woundValue}`).value = forearmWoundMeasurements[hand][woundValue].length || '';
        document.getElementById(`forearm-breadth-${hand}-${woundValue}`).value = forearmWoundMeasurements[hand][woundValue].breadth || '';
    }
}

function getSelectedForearmColor() {
    // Get the color from the last checked wound checkbox
    let checkedWounds = document.querySelectorAll('input[name="forearm-wound"]:checked');
    if (checkedWounds.length > 0) {
        return checkedWounds[checkedWounds.length - 1].value;
    }
    return 'black';
}

function enableForearmFreehandDrawing(canvas) {
    let ctx = canvas.getContext('2d');
    let drawing = false;

    function getMousePos(event) {
        let rect = canvas.getBoundingClientRect();
        return {
            x: event.clientX - rect.left,
            y: event.clientY - rect.top
        };
    }

    function startForearmDrawing(event) {
        drawing = true;
        let pos = getMousePos(event);
        ctx.beginPath();
        ctx.strokeStyle = getSelectedForearmColor();
        ctx.lineWidth = 3;
        ctx.moveTo(pos.x, pos.y);
    }

    function drawForearm(event) {
        if (!drawing) return;
        let pos = getMousePos(event);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
    }

    function stopForearmDrawing() {
        drawing = false;
    }

    canvas.addEventListener('mousedown', startForearmDrawing);
    canvas.addEventListener('mousemove', drawForearm);
    canvas.addEventListener('mouseup', stopForearmDrawing);
    canvas.addEventListener('mouseleave', stopForearmDrawing);
}
</script>
<hr style="border-top: 2px dotted black; width: 100%;">
<div class="flexor-container">
    <div class="flexor-section">
        <label>Is there a Flexor Tendon Injury?</label>
        <div class="flexor-radio-group">
            <input type="radio" id="flexorInjuryYes" name="flexorInjuryStatus" value="yes" onclick="toggleFlexorHandSelection(true)">
            <label for="flexorInjuryYes">Yes</label>

            <input type="radio" id="flexorInjuryNo" name="flexorInjuryStatus" value="no" onclick="toggleFlexorHandSelection(false)">
            <label for="flexorInjuryNo">No</label>
        </div>
    </div>

    <div class="flexor-section hidden" id="flexorHandSelectionSection">
        <label>Select Hand:</label>
        <div class="flexor-radio-group">
            <input type="radio" id="flexorLeftHand" name="flexorHandSelection" value="left" onclick="showFlexorHandImage()">
            <label for="flexorLeftHand">Left</label>

            <input type="radio" id="flexorRightHand" name="flexorHandSelection" value="right" onclick="showFlexorHandImage()">
            <label for="flexorRightHand">Right</label>

            <input type="radio" id="flexorBothHands" name="flexorHandSelection" value="both" onclick="showFlexorHandImage()">
            <label for="flexorBothHands">Both</label>
        </div>
    </div>

    <div class="flexor-section hidden" id="flexorHandImageSection">
        <div class="flexor-flexbox">
            <div class="flexor-hand-box">
                <img id="flexorHandMainImage" src="http://localhost:8000/flexor.png" class="flexor-hand-image" alt="Hand Image">
            </div>

            <div id="bothHandSelection" class="both-hands-container hidden">
                <div class="hand-selection">
                    <h3>Left Hand</h3>
                    <div id="leftHandZoneSelection"></div>
                </div>
                <div class="hand-selection">
                    <h3>Right Hand</h3>
                    <div id="rightHandZoneSelection"></div>
                </div>
            </div>

            <div id="singleHandSelection" class="hand-selection">
                <h3 id="handTitle"></h3>
                <div id="singleHandZoneSelection"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleFlexorHandSelection(isInjuryPresent) {
        document.getElementById("flexorHandSelectionSection").classList.toggle("hidden", !isInjuryPresent);
        document.getElementById("flexorHandImageSection").classList.add("hidden");
    }

    function showFlexorHandImage() {
        const selectedHand = document.querySelector('input[name="flexorHandSelection"]:checked').value;
        document.getElementById("flexorHandImageSection").classList.remove("hidden");

        if (selectedHand === "both") {
            document.getElementById("singleHandSelection").classList.add("hidden");
            document.getElementById("bothHandSelection").classList.remove("hidden");
            document.getElementById("leftHandZoneSelection").innerHTML = generateZoneSelectionHTML("left");
            document.getElementById("rightHandZoneSelection").innerHTML = generateZoneSelectionHTML("right");
        } else {
            document.getElementById("bothHandSelection").classList.add("hidden");
            document.getElementById("singleHandSelection").classList.remove("hidden");
            document.getElementById("handTitle").innerText = selectedHand.charAt(0).toUpperCase() + selectedHand.slice(1) + " Hand";
            document.getElementById("singleHandZoneSelection").innerHTML = generateZoneSelectionHTML(selectedHand);
        }
    }

    function generateZoneSelectionHTML(hand) {
        return `
            <label>Select Zones:</label>
            <div class="flexor-checkbox-group">
                <input type="checkbox" id="${hand}Zone1" name="${hand}Zones" value="zone1" onclick="toggleFlexorFingerSelection('${hand}')">
                <label for="${hand}Zone1">Zone 1</label>

                <input type="checkbox" id="${hand}Zone2" name="${hand}Zones" value="zone2" onclick="toggleFlexorFingerSelection('${hand}')">
                <label for="${hand}Zone2">Zone 2</label>
            </div>

            <label>Tendon-Specific Zones:</label>
            <div class="flexor-checkbox-group">
                <input type="checkbox" id="${hand}T1" name="${hand}TendonZones" value="T1">
                <label for="${hand}T1">T1</label>

                <input type="checkbox" id="${hand}T2" name="${hand}TendonZones" value="T2">
                <label for="${hand}T2">T2</label>

                <input type="checkbox" id="${hand}T3" name="${hand}TendonZones" value="T3">
                <label for="${hand}T3">T3</label>
            </div>

            <div id="${hand}FingerSelection" class="hidden">
                <label>Select Finger:</label>
                <div class="flexor-checkbox-group">
                    <input type="radio" name="${hand}Finger" value="thumb"> Thumb
                    <input type="radio" name="${hand}Finger" value="index"> Index
                    <input type="radio" name="${hand}Finger" value="middle"> Middle
                    <input type="radio" name="${hand}Finger" value="ring"> Ring
                    <input type="radio" name="${hand}Finger" value="little"> Little
                </div>
            </div>

            <label>Additional Zones:</label>
            <div class="flexor-checkbox-group">
                <input type="checkbox" name="${hand}AdditionalZones" value="zone3"> Zone 3 Palm
                <input type="checkbox" name="${hand}AdditionalZones" value="zone4"> Zone 4 Palm
                <input type="checkbox" name="${hand}AdditionalZones" value="zone5"> Zone 5
            </div>
        `;
    }
    function toggleFlexorFingerSelection(hand) {
        const isChecked = document.getElementById(`${hand}Zone1`).checked || document.getElementById(`${hand}Zone2`).checked;
        document.getElementById(`${hand}FingerSelection`).classList.toggle("hidden", !isChecked);
    }
</script>

<hr style="border-top: 2px dotted black; width: 100%;">

<div class="extensor-container">
    <div class="extensor-section">
        <label>Is there an Extensor Tendon Injury?</label>
        <div class="extensor-radio-group">
            <input type="radio" id="extensorInjuryYes" name="extensorInjuryStatus" value="yes" onclick="toggleExtensorHandSelection(true)">
            <label for="extensorInjuryYes">Yes</label>

            <input type="radio" id="extensorInjuryNo" name="extensorInjuryStatus" value="no" onclick="toggleExtensorHandSelection(false)">
            <label for="extensorInjuryNo">No</label>
        </div>
    </div>

    <div class="extensor-section hidden" id="extensorHandSelectionSection">
        <label>Select Hand:</label>
        <div class="extensor-radio-group">
            <input type="radio" id="extensorLeftHand" name="extensorHandSelection" value="left" onclick="showExtensorHandImage()">
            <label for="extensorLeftHand">Left</label>

            <input type="radio" id="extensorRightHand" name="extensorHandSelection" value="right" onclick="showExtensorHandImage()">
            <label for="extensorRightHand">Right</label>

            <input type="radio" id="extensorBothHands" name="extensorHandSelection" value="both" onclick="showExtensorHandImage()">
            <label for="extensorBothHands">Both</label>
        </div>
    </div>

    <div class="extensor-section hidden" id="extensorHandImageSection">
        <div class="extensor-flexbox">
            <div class="extensor-hand-box">
                <img id="extensorHandMainImage" src="http://localhost:8000/extensor.png" class="extensor-hand-image" alt="Hand Image">
            </div>

            <div id="bothExtensorHandSelection" class="both-hands-container hidden">
                <div class="hand-selection">
                    <h3>Left Hand</h3>
                    <div id="leftExtensorZoneSelection"></div>
                </div>
                <div class="hand-selection">
                    <h3>Right Hand</h3>
                    <div id="rightExtensorZoneSelection"></div>
                </div>
            </div>

            <div id="singleExtensorHandSelection" class="hand-selection">
                <h3 id="extensorHandTitle"></h3>
                <div id="singleExtensorZoneSelection"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleExtensorHandSelection(isInjuryPresent) {
        document.getElementById("extensorHandSelectionSection").classList.toggle("hidden", !isInjuryPresent);
        document.getElementById("extensorHandImageSection").classList.add("hidden");
    }

    function showExtensorHandImage() {
        const selectedHand = document.querySelector('input[name="extensorHandSelection"]:checked').value;
        document.getElementById("extensorHandImageSection").classList.remove("hidden");

        if (selectedHand === "both") {
            document.getElementById("singleExtensorHandSelection").classList.add("hidden");
            document.getElementById("bothExtensorHandSelection").classList.remove("hidden");
            document.getElementById("leftExtensorZoneSelection").innerHTML = generateExtensorZoneSelectionHTML("left");
            document.getElementById("rightExtensorZoneSelection").innerHTML = generateExtensorZoneSelectionHTML("right");
        } else {
            document.getElementById("bothExtensorHandSelection").classList.add("hidden");
            document.getElementById("singleExtensorHandSelection").classList.remove("hidden");
            document.getElementById("extensorHandTitle").innerText = selectedHand.charAt(0).toUpperCase() + selectedHand.slice(1) + " Hand";
            document.getElementById("singleExtensorZoneSelection").innerHTML = generateExtensorZoneSelectionHTML(selectedHand);
        }
    }

    function generateExtensorZoneSelectionHTML(hand) {
        return `
            <label>Select Zones:</label>
            <div class="extensor-checkbox-group">
                <input type="checkbox" id="${hand}ExtensorZone1" name="${hand}ExtensorZones" value="zone1" onclick="toggleExtensorFingerSelection('${hand}')">
                <label for="${hand}ExtensorZone1">Zone 1</label>

                <input type="checkbox" id="${hand}ExtensorZone2" name="${hand}ExtensorZones" value="zone2" onclick="toggleExtensorFingerSelection('${hand}')">
                <label for="${hand}ExtensorZone2">Zone 2</label>
            </div>

            <label>Tendon-Specific Zones:</label>
            <div class="extensor-checkbox-group">
                <input type="checkbox" id="${hand}T1" name="${hand}TendonZones" value="T1">
                <label for="${hand}T1">T1</label>

                <input type="checkbox" id="${hand}T2" name="${hand}TendonZones" value="T2">
                <label for="${hand}T2">T2</label>

                <input type="checkbox" id="${hand}T3" name="${hand}TendonZones" value="T3">
                <label for="${hand}T3">T3</label>
            </div>

            <div id="${hand}ExtensorFingerSelection" class="hidden">
                <label>Select Finger:</label>
                <div class="extensor-checkbox-group">
                    <input type="radio" name="${hand}ExtensorFinger" value="thumb"> Thumb
                    <input type="radio" name="${hand}ExtensorFinger" value="index"> Index
                    <input type="radio" name="${hand}ExtensorFinger" value="middle"> Middle
                    <input type="radio" name="${hand}ExtensorFinger" value="ring"> Ring
                    <input type="radio" name="${hand}ExtensorFinger" value="little"> Little
                </div>
            </div>

            <label>Additional Zones:</label>
            <div class="extensor-checkbox-group">
                <input type="checkbox" name="${hand}ExtensorAdditionalZones" value="zone3"> Zone 3 Palm
                <input type="checkbox" name="${hand}ExtensorAdditionalZones" value="zone4"> Zone 4 Palm
                <input type="checkbox" name="${hand}ExtensorAdditionalZones" value="zone5"> Zone 5
            </div>
        `;
    }

    function toggleExtensorFingerSelection(hand) {
        const isChecked = document.getElementById(`${hand}ExtensorZone1`).checked || document.getElementById(`${hand}ExtensorZone2`).checked;
        document.getElementById(`${hand}ExtensorFingerSelection`).classList.toggle("hidden", !isChecked);
    }
</script>
<hr style="border-top: 2px dotted black; width: 100%;">

<script>
    
    function vasc_handleVascularitySelection() {
        let vascularity = document.querySelector('input[name="vasc_vascularity"]:checked').value;
        document.getElementById('vasc_normalFeatures').style.display = (vascularity === 'present') ? 'block' : 'none';
        document.getElementById('vasc_handSelection').style.display = (vascularity !== 'present') ? 'block' : 'none';
        document.getElementById('vasc_fingerSelectionContainer').style.display = 'none';
        document.getElementById('vasc_leftFingerSelection').style.display = 'none';
        document.getElementById('vasc_rightFingerSelection').style.display = 'none';
        document.getElementById('vasc_tablesContainer').innerHTML = '';
    }

    function vasc_handleHandSelection() {
        let leftHand = document.getElementById('vasc_leftHand').checked;
        let rightHand = document.getElementById('vasc_rightHand').checked;
        let bothHands = document.getElementById('vasc_bothHands').checked;
        
        // Show/hide finger selection container
        document.getElementById('vasc_fingerSelectionContainer').style.display = 
            leftHand || rightHand || bothHands ? 'block' : 'none';
        
        // Show/hide left hand finger selection
        document.getElementById('vasc_leftFingerSelection').style.display = 
            (leftHand || bothHands) ? 'block' : 'none';
        
        // Show/hide right hand finger selection
        document.getElementById('vasc_rightFingerSelection').style.display = 
            (rightHand || bothHands) ? 'block' : 'none';
        
        // Clear any previous finger selections when changing hands
        if (!leftHand) {
            let leftFingers = document.querySelectorAll('input[name="vasc_leftFinger"]:checked');
            leftFingers.forEach(checkbox => checkbox.checked = false);
        }
        
        if (!rightHand) {
            let rightFingers = document.querySelectorAll('input[name="vasc_rightFinger"]:checked');
            rightFingers.forEach(checkbox => checkbox.checked = false);
        }
        
        // Clear any displayed tables
        document.getElementById('vasc_tablesContainer').innerHTML = '';
    }

    function vasc_handleFingerSelection() {
        let tablesContainer = document.getElementById('vasc_tablesContainer');
        tablesContainer.innerHTML = '';

        let leftSelectedFingers = Array.from(document.querySelectorAll('input[name="vasc_leftFinger"]:checked')).map(e => e.value);
        let rightSelectedFingers = Array.from(document.querySelectorAll('input[name="vasc_rightFinger"]:checked')).map(e => e.value);

        if (leftSelectedFingers.length) {
            tablesContainer.appendChild(vasc_createTable('Left Hand', leftSelectedFingers));
        }
        if (rightSelectedFingers.length) {
            tablesContainer.appendChild(vasc_createTable('Right Hand', rightSelectedFingers));
        }
    }

    function vasc_createTable(hand, selectedFingers) {
        let handTableContainer = document.createElement('div');
        handTableContainer.innerHTML = `<h3 class='vasc_center'>${hand}</h3>`;
        let tableHtml = `<table class="vasc_table">
            <tr>
                <th class="vasc_th">Digit</th>
                <th class="vasc_th">Colour</th>
                <th class="vasc_th">Turgor</th>
                <th class="vasc_th">Warmth</th>
                <th class="vasc_th">Capillary Refill Time</th>
                <th class="vasc_th">SpO2</th>
                <th class="vasc_th">SpO2 Waveform</th>
            </tr>`;
        selectedFingers.forEach(finger => {
            tableHtml += `<tr>
                <td class="vasc_td">${finger}</td>
                <td class="vasc_td"><select class="vasc_select"><option>Pink</option><option>Pale</option><option>Blue</option></select></td>
                <td class="vasc_td"><select class="vasc_select"><option>Normal</option><option>Reduced</option></select></td>
                <td class="vasc_td"><select class="vasc_select"><option>Present</option><option>Reduced</option><option>Absent</option></select></td>
                <td class="vasc_td"><select class="vasc_select"><option>Spontaneous</option><option>< 3 sec</option><option>> 3 sec</option></select></td>
                <td class="vasc_td"><input class="vasc_input" type="number" min="0" max="100"></td>
                <td class="vasc_td"><select class="vasc_select"><option>Triphasic</option><option>Biphasic</option></select></td>
            </tr>`;
        });
        tableHtml += `</table>`;
        handTableContainer.innerHTML += tableHtml;
        return handTableContainer;
    }
</script>
<div class="vasc_container">
    <label for="vasc_vascularity" class="vasc_form-label vasc_fw-bold">Vascularity:</label>
    <div class="vasc_center">
        <label class="vasc_label"><input type="radio" name="vasc_vascularity" value="present" onclick="vasc_handleVascularitySelection()"> Present</label>
        <label class="vasc_label"><input type="radio" name="vasc_vascularity" value="reduced" onclick="vasc_handleVascularitySelection()"> Reduced</label>
        <label class="vasc_label"><input type="radio" name="vasc_vascularity" value="absent" onclick="vasc_handleVascularitySelection()"> Absent</label>
    </div>
    <div id="vasc_normalFeatures" class="vasc_center" style="display:none;">
        <p class="vasc_p"><strong>All fingers have normal features:</strong></p>
        <ul class="vasc_ul">
            <li class="vasc_li">Pink skin</li>
            <li class="vasc_li">Normal turgor</li>
            <li class="vasc_li">Warmth is present</li>
            <li class="vasc_li">Capillary refill time is spontaneous</li>
        </ul>
    </div>
    <div id="vasc_handSelection" class="vasc_center" style="display:none;">
        <label for="vasc_selecthandd" class="vasc_form-label vasc_fw-bold">Select Hand:</label>
        <label class="vasc_label"><input type="checkbox" id="vasc_leftHand" value="Left" onclick="vasc_handleHandSelection()"> Left</label>
        <label class="vasc_label"><input type="checkbox" id="vasc_rightHand" value="Right" onclick="vasc_handleHandSelection()"> Right</label>
        <label class="vasc_label"><input type="checkbox" id="vasc_bothHands" value="Both" onclick="vasc_handleHandSelection()"> Both</label>
    </div>
    <div id="vasc_fingerSelectionContainer" class="vasc_center" style="display:none;">
        <label for="vasc_fingers" class="vasc_form-label vasc_fw-bold">Select fingers:</label>
        <div class="vasc_selection-container">
            <div id="vasc_leftFingerSelection" style="display:none;">
                <label for="vasc_left" class="vasc_form-label vasc_fw-bold">Left Hand:</label>
                <label class="vasc_label"><input type="checkbox" name="vasc_leftFinger" value="Thumb" onclick="vasc_handleFingerSelection()"> Thumb</label>
                <label class="vasc_label"><input type="checkbox" name="vasc_leftFinger" value="Index" onclick="vasc_handleFingerSelection()"> Index</label>
                <label class="vasc_label"><input type="checkbox" name="vasc_leftFinger" value="Middle" onclick="vasc_handleFingerSelection()"> Middle</label>
                <label class="vasc_label"><input type="checkbox" name="vasc_leftFinger" value="Ring" onclick="vasc_handleFingerSelection()"> Ring</label>
                <label class="vasc_label"><input type="checkbox" name="vasc_leftFinger" value="Little" onclick="vasc_handleFingerSelection()"> Little</label>
            </div>
            <div id="vasc_rightFingerSelection" style="display:none;">
                <label for="vasc_rightt" class="vasc_form-label vasc_fw-bold">Right Hand:</label>
                <label class="vasc_label"><input type="checkbox" name="vasc_rightFinger" value="Thumb" onclick="vasc_handleFingerSelection()"> Thumb</label>
                <label class="vasc_label"><input type="checkbox" name="vasc_rightFinger" value="Index" onclick="vasc_handleFingerSelection()"> Index</label>
                <label class="vasc_label"><input type="checkbox" name="vasc_rightFinger" value="Middle" onclick="vasc_handleFingerSelection()"> Middle</label>
                <label class="vasc_label"><input type="checkbox" name="vasc_rightFinger" value="Ring" onclick="vasc_handleFingerSelection()"> Ring</label>
                <label class="vasc_label"><input type="checkbox" name="vasc_rightFinger" value="Little" onclick="vasc_handleFingerSelection()"> Little</label>
            </div>
        </div>
    </div>
    <div id="vasc_tablesContainer"></div>
</div>
<hr style="border-top: 2px dotted black; width: 100%;">
   
        <label for="peri" class="form-label">Peripheral Pulses:</label>
             <div class="row">
                 <div class="col">
                     <label for="left" class="form-label">LEFT</label>
                 </div>
                 <div class="col">
                     <label for="right" class="form-label">RIGHT</label>
                 </div>
             </div>
             <div class="row">
                 <div class="col-md-3">
                    <h6>Radial</h6>
                 </div>
                 <div class="col-md-3">
                     <select class="form-select" id="radial">
                         <option value="present">Present</option>
                         <option value="Absent">Absent</option>
                         <option value="Reduced">Reduced</option>
                       </select>
                 </div>
                 <div class="col-md-3">
                     <h6>Radial</h6>
                 </div>
                 <div class="col-md-3">
                     <select class="form-select" id="ulnar">
                         <option value="present">Present</option>
                         <option value="Absent">Absent</option>
                         <option value="Reduced">Reduced</option>
                       </select>
                 </div>
             </div>
             <div class="row">
                 <div class="col-md-3">
                    <h6>Ulnar</h6>
                 </div>
                 <div class="col-md-3">
                     <select class="form-select" id="ulnar">
                         <option value="present">Present</option>
                         <option value="Absent">Absent</option>
                         <option value="Reduced">Reduced</option>
                       </select>
                 </div>
                 <div class="col-md-3">
                     <h6>Radial</h6>
                 </div>
                 <div class="col-md-3">
                     <select class="form-select" id="radial">
                         <option value="present">Present</option>
                         <option value="Absent">Absent</option>
                         <option value="Reduced">Reduced</option>
                       </select>
                 </div>
             </div>
             <hr style="border-top: 2px dotted black; width: 100%;">

             <div style="text-align: center;">
                <label class="form-label">Handheld Doppler</label>
                <div style="display: flex; justify-content: center; gap: 15px; margin-top: 5px;">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="doppler" id="notdone" value="notdone" checked>
                        <label class="form-check-label" for="notdone">Not Done</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="doppler" id="done" value="done">
                        <label class="form-check-label" for="done">Done</label>
                    </div>
                </div>
            </div>
             <hr style="border-top: 2px dotted black; width: 100%;">
                 <div class="question">
                    <label>Is E/O Compartment Syndrome present?</label>
                    <div class="radio-group">
                        <input type="radio" id="yes" name="syndrome_present" value="yes" onchange="toggleSymptoms()">
                        <label for="yes" style="display: inline;">Yes</label>
                        
                        <input type="radio" id="no" name="syndrome_present" value="no" onchange="toggleSymptoms()" style="margin-left: 20px;">
                        <label for="no" style="display: inline;">No</label>
                    </div>
                    
                    <div id="symptoms" class="symptoms">
                        <label>Select all symptoms that are present:</label>
                        
                        <div class="symptoms-row">
                            <div class="symptom-item">
                                <input type="checkbox" id="pain" name="symptoms" value="pain">
                                <label for="pain" style="display: inline;">Pain out-of-proportion</label>
                            </div>
                            
                            <div class="symptom-item">
                                <input type="checkbox" id="stretch" name="symptoms" value="stretch">
                                <label for="stretch" style="display: inline;">Stretch pain</label>
                            </div>
                            
                            <div class="symptom-item">
                                <input type="checkbox" id="induration" name="symptoms" value="induration">
                                <label for="induration" style="display: inline;">Induration (woody feel)</label>
                            </div>
                            
                            <div class="symptom-item">
                                <input type="checkbox" id="paraesthesia" name="symptoms" value="paraesthesia">
                                <label for="paraesthesia" style="display: inline;">Paraesthesia</label>
                            </div>
                            
                            <div class="symptom-item">
                                <input type="checkbox" id="paralysis" name="symptoms" value="paralysis">
                                <label for="paralysis" style="display: inline;">Paralysis</label>
                            </div>
                            
                            <div class="symptom-item">
                                <input type="checkbox" id="pulselessness" name="symptoms" value="pulselessness">
                                <label for="pulselessness" style="display: inline;">Pulselessness</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
            <script>
                function toggleSymptoms() {
                    const symptomsDiv = document.getElementById('symptoms');
                    const isYesSelected = document.getElementById('yes').checked;
                    
                    if (isYesSelected) {
                        symptomsDiv.style.display = 'block';
                    } else {
                        symptomsDiv.style.display = 'none';
                        // Clear checkboxes when "No" is selected
                        const checkboxes = document.querySelectorAll('input[name="symptoms"]');
                        checkboxes.forEach(checkbox => {
                            checkbox.checked = false;
                        });
                    }
                }
            </script>
             <hr style="border-top: 2px dotted black; width: 100%;">

             <label for="brachial" class="form-label fw-bold">Associated Brachial Plexus Injury?</label><br>
             <div>
                 <input type="radio" id="injury_yes" name="brachial_injury" value="yes" onclick="toggleSections()"> Yes
                 <input type="radio" id="injury_no" name="brachial_injury" value="no" onclick="toggleSections()"> No
             </div>
             
             <div id="injury_sections" class="hidden flex-container">
                 <div>
                    <label for="l" class="form-label fw-bold">Left</label><br>
                     <input type="radio" name="left_injury" value="upper"> Upper Plexus
                     <input type="radio" name="left_injury" value="extended_upper"> Extended Upper Plexus
                     <input type="radio" name="left_injury" value="global"> Global
                 </div>
                 <div>
                    <label for="r" class="form-label fw-bold">Right</label><br>
                     <input type="radio" name="right_injury" value="upper"> Upper Plexus
                     <input type="radio" name="right_injury" value="extended_upper"> Extended Upper Plexus
                     <input type="radio" name="right_injury" value="global"> Global
                 </div>
             </div>
             <script>
                function toggleSections() {
                    var injuryYes = document.getElementById("injury_yes").checked;
                    var sections = document.getElementById("injury_sections");
                    
                    if (injuryYes) {
                        sections.classList.remove("hidden");
                    } else {
                        sections.classList.add("hidden");
                    }
                }
            </script>
                
                <hr style="border-top: 2px dotted black; width: 100%;">
                <label for="neurological_nero" class="form-label fw-bold">Neurological Deficit?</label><br>
                <div class="neurological-radio-container">
                    <input type="radio" id="neurological_deficit_present" name="neurological_deficit" value="present" onclick="toggleNeurologicalTable()"> Present
                    <input type="radio" id="neurological_deficit_absent" name="neurological_deficit" value="absent" onclick="toggleNeurologicalTable()"> Absent
                </div>
                
                <div id="neurological_deficit_table" class="hidden">
                    <table class="neurological-table">
                        <tr>
                            <th></th>
                            <th colspan="2">Left</th>
                            <th colspan="2">Right</th>
                        </tr>
                        <tr>
                            <th></th>
                            <th>Motor</th>
                            <th>Sensory</th>
                            <th>Motor</th>
                            <th>Sensory</th>
                        </tr>
                        <tr>
                            <td>Median</td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                        </tr>
                        <tr>
                            <td>Ulnar</td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                        </tr>
                        <tr>
                            <td>Radial</td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                        </tr>
                        <tr>
                            <td>Musculocutaneous</td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                        </tr>
                        <tr>
                            <td>Axillary</td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                            <td><input type="checkbox"></td>
                        </tr>
                        <tr>
                            <td>Others:</td>
                            <td><input type="text"></td>
                            <td><input type="text"></td>
                            <td><input type="text"></td>
                            <td><input type="text"></td>
                        </tr>
                    </table>
                </div>
                
                <script>
                    function toggleNeurologicalTable() {
                        var deficitPresent = document.getElementById("neurological_deficit_present").checked;
                        var tableSection = document.getElementById("neurological_deficit_table");
                        
                        if (deficitPresent) {
                            tableSection.classList.remove("hidden");
                        } else {
                            tableSection.classList.add("hidden");
                        }
                    }
                </script>
            <hr style="border-top: 2px dotted black; width: 100%;">
            <div id="bone_assessment_section">
                <label for="bone_status_options" class="bone-form-label">Bones and Joints:</label>
                <div class="bone-radio-container" id="bone_status_options">
                    <input type="radio" id="bone_assessment_present" name="bone_assessment_status" value="present" onclick="toggleBoneSection()">
                    <label for="bone_assessment_present">Present</label>
                    <input type="radio" id="bone_assessment_absent" name="bone_assessment_status" value="absent" onclick="toggleBoneSection()">
                    <label for="bone_assessment_absent">Absent</label>
                </div>
                
                <div id="bone_assessment_details" class="bone-form-hidden">
                    <div class="bone-hand-selection">
                        <label class="bone-form-label">Which hand?</label>
                        <div class="bone-radio-container">
                            <input type="radio" id="bone_left_hand" name="bone_hand_side" value="left" onclick="showBoneHandImages()">
                            <label for="bone_left_hand">Left</label>
                            <input type="radio" id="bone_right_hand" name="bone_hand_side" value="right" onclick="showBoneHandImages()">
                            <label for="bone_right_hand">Right</label>
                            <input type="radio" id="bone_both_hands" name="bone_hand_side" value="both" onclick="showBoneHandImages()">
                            <label for="bone_both_hands">Both</label>
                        </div>
                    </div>
                    
                    <table class="bone-table">
                        <tr>
                            <th>Condition</th>
                            <th>Details</th>
                        </tr>
                        <tr>
                            <td>Open Fractures</td>
                            <td><input type="text" id="bone_openfracture" class="bone-form-control"></td>
                        </tr>
                        <tr>
                            <td>Closed Fractures</td>
                            <td><input type="text" id="bone_closedfracture" class="bone-form-control"></td>
                        </tr>
                        <tr>
                            <td>Dislocation</td>
                            <td><input type="text" id="bone_dislocation" class="bone-form-control"></td>
                        </tr>
                        <tr>
                            <td>Instability</td>
                            <td><input type="text" id="bone_instability" class="bone-form-control"></td>
                        </tr>
                    </table>
                    
                    <div id="bone_hand_images" class="bone-form-hidden bone-images-container">
                        <div id="bone_left_image" class="bone-hand-image bone-form-hidden">
                            <h4>Left Hand</h4>
                            <div class="bone-flex-container">
                                <div class="bone-canvas-container">
                                    <img src="http://localhost:8000/leftimage.png" alt="Left hand diagram" class="bone-hand-base-image" id="bone_left_base_img">
                                    <svg id="bone_left_drawing_canvas" class="bone-drawing-canvas" width="250" height="300"></svg>
                                </div>
                                
                                <div class="bone-uploaded-image-container">
                                    <div class="bone-upload-section">
                                        <label for="bone_left_upload" class="bone-upload-label">Upload Left Hand Image:</label>
                                        <input type="file" id="bone_left_upload" accept="image/*" onchange="handleBoneImageUpload('left')">
                                    </div>
                                    <div id="bone_left_uploaded_image_container" class="bone-uploaded-preview bone-form-hidden">
                                        <img id="bone_left_uploaded_image" class="bone-uploaded-image" alt="Uploaded left hand image">
                                        <button class="bone-tool-button bone-remove-btn" onclick="removeBoneUploadedImage('left')">Remove</button>
                                    </div>
                                </div>
                            </div>
                            <div class="bone-drawing-tools">
                                <div class="bone-color-picker">
                                    <div class="bone-color-option selected" style="background-color: red;" data-color="red" onclick="setBoneColor('left', 'red')"></div>
                                    <div class="bone-color-option" style="background-color: blue;" data-color="blue" onclick="setBoneColor('left', 'blue')"></div>
                                    <div class="bone-color-option" style="background-color: green;" data-color="green" onclick="setBoneColor('left', 'green')"></div>
                                    <div class="bone-color-option" style="background-color: black;" data-color="black" onclick="setBoneColor('left', 'black')"></div>
                                </div>
                                <button class="bone-tool-button" onclick="clearBoneCanvas('left')">Clear</button>
                            </div>
                        </div>
                        
                        <div id="bone_right_image" class="bone-hand-image bone-form-hidden">
                            <h4>Right Hand</h4>
                            <div class="bone-flex-container">
                                <div class="bone-canvas-container">
                                    <img src="http://localhost:8000/rightbone.png" alt="Right hand diagram" class="bone-hand-base-image" id="bone_right_base_img">
                                    <svg id="bone_right_drawing_canvas" class="bone-drawing-canvas" width="250" height="300"></svg>
                                </div>
                                
                                <div class="bone-uploaded-image-container">
                                    <div class="bone-upload-section">
                                        <label for="bone_right_upload" class="bone-upload-label">Upload Right Hand Image:</label>
                                        <input type="file" id="bone_right_upload" accept="image/*" onchange="handleBoneImageUpload('right')">
                                    </div>
                                    <div id="bone_right_uploaded_image_container" class="bone-uploaded-preview bone-form-hidden">
                                        <img id="bone_right_uploaded_image" class="bone-uploaded-image" alt="Uploaded right hand image">
                                    </div>
                                </div>
                            </div>
                            <div class="bone-drawing-tools">
                                <div class="bone-color-picker">
                                    <div class="bone-color-option selected" style="background-color: red;" data-color="red" onclick="setBoneColor('right', 'red')"></div>
                                    <div class="bone-color-option" style="background-color: blue;" data-color="blue" onclick="setBoneColor('right', 'blue')"></div>
                                    <div class="bone-color-option" style="background-color: green;" data-color="green" onclick="setBoneColor('right', 'green')"></div>
                                    <div class="bone-color-option" style="background-color: black;" data-color="black" onclick="setBoneColor('right', 'black')"></div>
                                </div>
                                <button class="bone-tool-button" onclick="clearBoneCanvas('right')">Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <script>
                // Drawing settings - namespace is prefixed with 'bone' to avoid conflicts
                const boneDrawingState = {
                    left: {
                        isDrawing: false,
                        color: 'red',
                        paths: []
                    },
                    right: {
                        isDrawing: false,
                        color: 'red',
                        paths: []
                    }
                };
            
                function toggleBoneSection() {
                    var presentChecked = document.getElementById("bone_assessment_present").checked;
                    var section = document.getElementById("bone_assessment_details");
                    var handImages = document.getElementById("bone_hand_images");
                    
                    if (presentChecked) {
                        section.classList.remove("bone-form-hidden");
                    } else {
                        section.classList.add("bone-form-hidden");
                        handImages.classList.add("bone-form-hidden");
                        
                        // Reset hand selection when "Absent" is selected
                        var handRadios = document.getElementsByName("bone_hand_side");
                        for (var i = 0; i < handRadios.length; i++) {
                            handRadios[i].checked = false;
                        }
                        
                        // Hide all images
                        document.getElementById("bone_left_image").classList.add("bone-form-hidden");
                        document.getElementById("bone_right_image").classList.add("bone-form-hidden");
                        
                        // Reset uploaded images
                        resetBoneUploadedImages();
                    }
                }
                
                function showBoneHandImages() {
                    var leftChecked = document.getElementById("bone_left_hand").checked;
                    var rightChecked = document.getElementById("bone_right_hand").checked;
                    var bothChecked = document.getElementById("bone_both_hands").checked;
                    
                    var handImages = document.getElementById("bone_hand_images");
                    var leftImage = document.getElementById("bone_left_image");
                    var rightImage = document.getElementById("bone_right_image");
                    
                    // First show the container
                    handImages.classList.remove("bone-form-hidden");
                    
                    // Then show/hide appropriate images based on selection
                    if (leftChecked) {
                        leftImage.classList.remove("bone-form-hidden");
                        rightImage.classList.add("bone-form-hidden");
                        initBoneDrawing('left');
                    } else if (rightChecked) {
                        leftImage.classList.add("bone-form-hidden");
                        rightImage.classList.remove("bone-form-hidden");
                        initBoneDrawing('right');
                    } else if (bothChecked) {
                        leftImage.classList.remove("bone-form-hidden");
                        rightImage.classList.remove("bone-form-hidden");
                        initBoneDrawing('left');
                        initBoneDrawing('right');
                    }
                }
                
                function resetBoneUploadedImages() {
                    // Reset file inputs
                    if (document.getElementById("bone_left_upload")) {
                        document.getElementById("bone_left_upload").value = "";
                    }
                    if (document.getElementById("bone_right_upload")) {
                        document.getElementById("bone_right_upload").value = "";
                    }
                    
                    // Hide preview containers
                    document.getElementById("bone_left_uploaded_image_container").classList.add("bone-form-hidden");
                    document.getElementById("bone_right_uploaded_image_container").classList.add("bone-form-hidden");
                }
                
                function handleBoneImageUpload(hand) {
                    const fileInput = document.getElementById(`bone_${hand}_upload`);
                    const previewContainer = document.getElementById(`bone_${hand}_uploaded_image_container`);
                    const previewImage = document.getElementById(`bone_${hand}_uploaded_image`);
                    
                    if (fileInput.files && fileInput.files[0]) {
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            previewImage.src = e.target.result;
                            previewContainer.classList.remove("bone-form-hidden");
                        }
                        
                        reader.readAsDataURL(fileInput.files[0]);
                    }
                }
                
                function initBoneDrawing(hand) {
                    const svg = document.getElementById(`bone_${hand}_drawing_canvas`);
                    
                    // Remove existing listeners to prevent duplicates
                    svg.replaceWith(svg.cloneNode(true));
                    
                    // Get the new element after cloning
                    const newSvg = document.getElementById(`bone_${hand}_drawing_canvas`);
                    
                    // Add event listeners for drawing
                    newSvg.addEventListener('mousedown', (e) => startBoneDrawing(e, hand));
                    newSvg.addEventListener('mousemove', (e) => drawBone(e, hand));
                    newSvg.addEventListener('mouseup', () => stopBoneDrawing(hand));
                    newSvg.addEventListener('mouseleave', () => stopBoneDrawing(hand));
                    
                    // Touch support
                    newSvg.addEventListener('touchstart', (e) => startBoneDrawing(e, hand));
                    newSvg.addEventListener('touchmove', (e) => drawBone(e, hand));
                    newSvg.addEventListener('touchend', () => stopBoneDrawing(hand));
                }
                
                function startBoneDrawing(event, hand) {
                    event.preventDefault();
                    boneDrawingState[hand].isDrawing = true;
                    
                    const svg = document.getElementById(`bone_${hand}_drawing_canvas`);
                    const rect = svg.getBoundingClientRect();
                    
                    // Get coordinates
                    let x, y;
                    if (event.type.startsWith('touch')) {
                        x = event.touches[0].clientX - rect.left;
                        y = event.touches[0].clientY - rect.top;
                    } else {
                        x = event.clientX - rect.left;
                        y = event.clientY - rect.top;
                    }
                    
                    // Create a new path
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    path.setAttribute('fill', 'none');
                    path.setAttribute('stroke', boneDrawingState[hand].color);
                    path.setAttribute('stroke-width', '2');
                    path.setAttribute('d', `M ${x} ${y}`);
                    
                    svg.appendChild(path);
                    boneDrawingState[hand].paths.push({
                        element: path,
                        d: `M ${x} ${y}`
                    });
                }
                
                function drawBone(event, hand) {
    if (!boneDrawingState[hand].isDrawing) return;
    event.preventDefault();
    
    const svg = document.getElementById(`bone_${hand}_drawing_canvas`);
    const rect = svg.getBoundingClientRect();
    
    // Get coordinates
    let x, y;
    if (event.type.startsWith('touch')) {
        x = event.touches[0].clientX - rect.left;
        y = event.touches[0].clientY - rect.top;
    } else {
        x = event.clientX - rect.left;
        y = event.clientY - rect.top;
    }
    
    // Get current path
    const currentPath = boneDrawingState[hand].paths[boneDrawingState[hand].paths.length - 1];
    const newD = `${currentPath.d} L ${x} ${y}`;
    
    currentPath.d = newD;
    currentPath.element.setAttribute('d', newD);
}

function stopBoneDrawing(hand) {
    boneDrawingState[hand].isDrawing = false;
}

function setBoneColor(hand, color) {
    boneDrawingState[hand].color = color;
    
    // Update UI
    const colorOptions = document.querySelectorAll(`#bone_${hand}_image .bone-color-option`);
    colorOptions.forEach(option => {
        if (option.dataset.color === color) {
            option.classList.add('selected');
        } else {
            option.classList.remove('selected');
        }
    });
}

function clearBoneCanvas(hand) {
    const svg = document.getElementById(`bone_${hand}_drawing_canvas`);
    while (svg.firstChild) {
        svg.removeChild(svg.firstChild);
    }
    boneDrawingState[hand].paths = [];
}

function handleBoneImageUpload(hand) {
    const fileInput = document.getElementById(`bone_${hand}_upload`);
    const previewContainer = document.getElementById(`bone_${hand}_uploaded_image_container`);
    const previewImage = document.getElementById(`bone_${hand}_uploaded_image`);
    
    if (fileInput.files && fileInput.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            previewImage.src = e.target.result;
            previewContainer.classList.remove("bone-form-hidden");
        }
        
        reader.readAsDataURL(fileInput.files[0]);
    }
}

function removeBoneUploadedImage(hand) {
    // Clear the file input
    document.getElementById(`bone_${hand}_upload`).value = "";
    
    // Hide the preview container
    document.getElementById(`bone_${hand}_uploaded_image_container`).classList.add("bone-form-hidden");
    
    // Clear the image source
    document.getElementById(`bone_${hand}_uploaded_image`).src = "";
}
</script>
 <hr style="border-top: 2px dotted black; width: 100%;">
 <label for="duncan" class="form-label">Duncan's Classification for Open Hand Fracture (Modified Gustillo-Anderson)</label>
 <div>
     <div style="display: flex; align-items: center; margin-bottom: 10px; border: 1px solid black; padding: 10px;">
         <input type="checkbox" id="classI" name="classification" value="I" style="margin-right: 10px;">
         <div style="width: 50px; font-weight: bold;">I</div>
         <div style="flex: 1;">
             Tidy laceration &lt; 1 cm in length, no soiling, no soft tissue loss or crush. Basically a puncture wound from within or without.
         </div>
     </div>
     <div style="display: flex; align-items: center; margin-bottom: 10px; border: 1px solid black; padding: 10px;">
         <input type="checkbox" id="classII" name="classification" value="II" style="margin-right: 10px;">
         <div style="width: 50px; font-weight: bold;">II</div>
         <div style="flex: 1;">
             Tidy laceration &lt; 2 cm in length, from outside in, no soiling, no soft tissue crush or loss. Partial muscle laceration.
         </div>
     </div>
     <div style="display: flex; align-items: center; margin-bottom: 10px; border: 1px solid black; padding: 10px;">
         <input type="checkbox" id="classIIIA" name="classification" value="III A" style="margin-right: 10px;">
         <div style="width: 50px; font-weight: bold;">III A</div>
         <div style="flex: 1;">
             Laceration &gt; 2 cm, penetrating or puncturing projectile wound. Any frankly soiled wound.
         </div>
     </div>
     <div style="display: flex; align-items: center; margin-bottom: 10px; border: 1px solid black; padding: 10px;">
         <input type="checkbox" id="classIIIB" name="classification" value="III B" style="margin-right: 10px;">
         <div style="width: 50px; font-weight: bold;">III B</div>
         <div style="flex: 1;">
             Same as IIIA + any periosteal elevation or stripping.
         </div>
     </div>
     <div style="display: flex; align-items: center; margin-bottom: 10px; border: 1px solid black; padding: 10px;">
         <input type="checkbox" id="classIIIC" name="classification" value="III C" style="margin-right: 10px;">
         <div style="width: 50px; font-weight: bold;">III C</div>
         <div style="flex: 1;">
             Same as IIIB + neurovascular injury.
         </div>
     </div>
 </div>
<hr style="border-top: 2px dotted black; width: 100%;">
<label for="distal-fracture">Distal Radius Fracture:</label>
    <select id="distal-fracture" onchange="updateDistalUI()">
        <option value="NIL">NIL</option>
        <option value="LEFT">LEFT</option>
        <option value="RIGHT">RIGHT</option>
        <option value="BOTH">BOTH</option>
    </select>

    <!-- Images -->
    <div id="distal-image-container" class="image-container hidden">
        <img src="http://localhost:8000/img8.png" alt="X-ray Image 1">
        <img src="http://localhost:8000/img9.png" alt="X-ray Image 2">
        <img src="http://localhost:8000/img10.png" alt="X-ray Image 3">
    </div>

    <!-- Table -->
    <table id="distal-table" class="hidden">
        <tr>
            <th>Fernandez</th>
            <td>
                <select id="distal-fernandez-left" class="hidden">
                    <option value="">Select Type</option>
                    <option value="bending">Bending</option>
                    <option value="shearing">Shearing</option>
                    <option value="compression">Compression</option>
                    <option value="avulsion">Avulsion</option>
                    <option value="compulsion">Compulsion</option>
                </select>
                <div id="distal-separator-left" class="separator hidden"></div>
                <select id="distal-fernandez-right" class="hidden">
                    <option value="">Select Type</option>
                    <option value="bending">Bending</option>
                    <option value="shearing">Shearing</option>
                    <option value="compression">Compression</option>
                    <option value="avulsion">Avulsion</option>
                    <option value="compulsion">Compulsion</option>
                </select>
            </td>
        </tr>
        <tr>
            <th>Frykman</th>
            <td>
                <select id="distal-frykman-left" class="hidden">
                    <option value="">Select Type</option>
                    <option value="1">Type 1</option>
                    <option value="2">Type 2</option>
                    <option value="3">Type 3</option>
                    <option value="4">Type 4</option>
                    <option value="5">Type 5</option>
                    <option value="6">Type 6</option>
                    <option value="7">Type 7</option>
                    <option value="8">Type 8</option>
                </select>
                <div id="distal-separator-frykman" class="separator hidden"></div>
                <select id="distal-frykman-right" class="hidden">
                    <option value="">Select Type</option>
                    <option value="1">Type 1</option>
                    <option value="2">Type 2</option>
                    <option value="3">Type 3</option>
                    <option value="4">Type 4</option>
                    <option value="5">Type 5</option>
                    <option value="6">Type 6</option>
                    <option value="7">Type 7</option>
                    <option value="8">Type 8</option>
                </select>
            </td>
        </tr>
        <tr>
            <th>Melone</th>
            <td>
                <select id="distal-melone-left" class="hidden">
                    <option value="">Select Type</option>
                    <option value="1">Type 1</option>
                    <option value="2a">Type 2A</option>
                    <option value="2b">Type 2B</option>
                    <option value="3">Type 3</option>
                    <option value="4">Type 4</option>
                    <option value="5">Type 5</option>
                </select>
                <div id="distal-separator-melone" class="separator hidden"></div>
                <select id="distal-melone-right" class="hidden">
                    <option value="">Select Type</option>
                    <option value="1">Type 1</option>
                    <option value="2a">Type 2A</option>
                    <option value="2b">Type 2B</option>
                    <option value="3">Type 3</option>
                    <option value="4">Type 4</option>
                    <option value="5">Type 5</option>
                </select>
            </td>
        </tr>
    </table>

    <script>
        function updateDistalUI() {
            var selection = document.getElementById("distal-fracture").value;
            var imageContainer = document.getElementById("distal-image-container");
            var table = document.getElementById("distal-table");

            // Dropdowns for each hand
            var leftElements = [
                document.getElementById("distal-fernandez-left"),
                document.getElementById("distal-frykman-left"),
                document.getElementById("distal-melone-left")
            ];
            var rightElements = [
                document.getElementById("distal-fernandez-right"),
                document.getElementById("distal-frykman-right"),
                document.getElementById("distal-melone-right")
            ];
            var separators = [
                document.getElementById("distal-separator-left"),
                document.getElementById("distal-separator-frykman"),
                document.getElementById("distal-separator-melone")
            ];

            // Hide all initially
            imageContainer.classList.add("hidden");
            table.classList.add("hidden");
            leftElements.forEach(el => el.classList.add("hidden"));
            rightElements.forEach(el => el.classList.add("hidden"));
            separators.forEach(el => el.classList.add("hidden"));

            if (selection !== "NIL") {
                imageContainer.classList.remove("hidden");
                table.classList.remove("hidden");

                if (selection === "LEFT" || selection === "BOTH") {
                    leftElements.forEach(el => el.classList.remove("hidden"));
                }
                if (selection === "RIGHT" || selection === "BOTH") {
                    rightElements.forEach(el => el.classList.remove("hidden"));
                }
                if (selection === "BOTH") {
                    separators.forEach(el => el.classList.remove("hidden"));
                }
            }
        }
    </script>
    <hr style="border-top: 2px dotted black; width: 100%;">
      <label for="exam" class="form-label">EXAMINATION OF PROXIMAL UPPER EXTREMITY:</label></div>
     <label for="handSelectExtreme">Select Hand:</label>
     <select id="handSelectExtreme">
         <option value="none">-- Select --</option>
         <option value="left">Left Hand</option>
         <option value="right">Right Hand</option>
         <option value="both">Both Hands</option>
     </select>
 
     <div id="handContainerExtreme" class="hand-container-extreme">
         <div class="hand-wrapper">
             <img id="leftHandExtreme" class="hand-extreme hidden" src="http://localhost:8000/proximalleft.png" alt="Left Hand">
         </div>
         <div class="hand-wrapper">
             <img id="rightHandExtreme" class="hand-extreme hidden" src="http://localhost:8000/proximalright.png" alt="Right Hand">
         </div>
     </div>
 
     
 
     <div class="radio-group">
         <label>
             <input type="radio" name="openWounds" value="no" checked> No Open Wounds
         </label>
         <label>
             <input type="radio" name="openWounds" value="yes"> Open Wounds Present
         </label>
     </div>
 
     <textarea 
         id="woundDescription" 
         rows="4" 
         placeholder="Describe the wound(s): location, size, appearance..."
     ></textarea>
 
     <script>
         const handSelect = document.getElementById("handSelectExtreme");
         const leftHand = document.getElementById("leftHandExtreme");
         const rightHand = document.getElementById("rightHandExtreme");
         const clearMarkersBtn = document.getElementById("clearMarkersBtn");
         const woundRadios = document.getElementsByName('openWounds');
         const woundDescription = document.getElementById('woundDescription');
 
         // Toggle visibility of wound description textarea
         woundRadios.forEach(radio => {
             radio.addEventListener('change', function() {
                 woundDescription.style.display = this.value === 'yes' ? 'block' : 'none';
             });
         });
 
         // Hand selection logic
         handSelect.addEventListener("change", function() {
             leftHand.classList.add("hidden");
             rightHand.classList.add("hidden");
             clearMarkers();
 
             if (this.value === "left") {
                 leftHand.classList.remove("hidden");
             } else if (this.value === "right") {
                 rightHand.classList.remove("hidden");
             } else if (this.value === "both") {
                 leftHand.classList.remove("hidden");
                 rightHand.classList.remove("hidden");
             }
         });
 
         // Add marker function
         function addMarker(event) {
             if (handSelect.value === "none") {
                 alert("Please select a hand first!");
                 return;
             }
 
             const marker = document.createElement("div");
             marker.classList.add("marker");
 
             const hand = event.target;
             const rect = hand.getBoundingClientRect();
             const x = event.clientX - rect.left;
             const y = event.clientY - rect.top;
 
             marker.style.left = `${x}px`;
             marker.style.top = `${y}px`;
 
             marker.addEventListener('click', function() {
                 this.remove();
             });
 
             hand.parentElement.appendChild(marker);
         }
 
         // Clear markers function
         function clearMarkers() {
             document.querySelectorAll('.marker').forEach(marker => marker.remove());
         }
 
         // Add event listeners for hands
         leftHand.addEventListener('click', addMarker);
         rightHand.addEventListener('click', addMarker);
 
     </script>
         <hr style="border-top: 2px dotted black; width: 100%;">
         <label for="exam" class="form-label">EXAMINATION OF LOWER EXTREMITY(INCLUDING PELVIS):</label></div>
         <label for="handSelectLowerExtreme">Select Limb:</label>
         <select id="handSelectLowerExtreme">
             <option value="none">-- Select --</option>
             <option value="left">Left Leg</option>
             <option value="right">Right Leg</option>
             <option value="both">Both Legs</option>
         </select>
     
         <div id="handContainerLowerExtreme" class="hand-container-lower-extreme">
             <div class="hand-wrapper">
                 <img id="leftHandLowerExtreme" class="hand-lower-extreme hidden" src="http://localhost:8000/lowerleftextreme.png" alt="Left Leg">
             </div>
             <div class="hand-wrapper">
                 <img id="rightHandLowerExtreme" class="hand-lower-extreme hidden" src="http://localhost:8000/lowerrightextreme.png" alt="Right Leg">
             </div>
            </div>
     
         <div class="radio-group">
             <label>
                 <input type="radio" name="openWoundsLowerExtreme" value="no" checked> No Open Wounds
             </label>
             <label>
                 <input type="radio" name="openWoundsLowerExtreme" value="yes"> Open Wounds Present
             </label>
         </div>
     
         <textarea 
             id="woundDescriptionLowerExtreme" 
             rows="4" 
             placeholder="Describe the wound(s): location, size, appearance..."
         ></textarea>
     
         <script>
             const handSelectLowerExtreme = document.getElementById("handSelectLowerExtreme");
             const leftHandLowerExtreme = document.getElementById("leftHandLowerExtreme");
             const rightHandLowerExtreme = document.getElementById("rightHandLowerExtreme");
             const clearMarkersBtnLowerExtreme = document.getElementById("clearMarkersBtnLowerExtreme");
             const woundRadiosLowerExtreme = document.getElementsByName('openWoundsLowerExtreme');
             const woundDescriptionLowerExtreme = document.getElementById('woundDescriptionLowerExtreme');
     
             // Toggle visibility of wound description textarea
             woundRadiosLowerExtreme.forEach(radio => {
                 radio.addEventListener('change', function() {
                     woundDescriptionLowerExtreme.style.display = this.value === 'yes' ? 'block' : 'none';
                 });
             });
     
             // Hand selection logic
             handSelectLowerExtreme.addEventListener("change", function() {
                 leftHandLowerExtreme.classList.add("hidden");
                 rightHandLowerExtreme.classList.add("hidden");
                 clearMarkersLowerExtreme();
     
                 if (this.value === "left") {
                     leftHandLowerExtreme.classList.remove("hidden");
                 } else if (this.value === "right") {
                     rightHandLowerExtreme.classList.remove("hidden");
                 } else if (this.value === "both") {
                     leftHandLowerExtreme.classList.remove("hidden");
                     rightHandLowerExtreme.classList.remove("hidden");
                 }
             });
     
             // Add marker function for lower limbs
             function addMarkerLowerExtreme(event) {
                 if (handSelectLowerExtreme.value === "none") {
                     alert("Please select a limb first!");
                     return;
                 }
     
                 const marker = document.createElement("div");
                 marker.classList.add("marker-lower-extreme");
     
                 const hand = event.target;
                 const rect = hand.getBoundingClientRect();
                 const x = event.clientX - rect.left;
                 const y = event.clientY - rect.top;
     
                 marker.style.left = `${x}px`;
                 marker.style.top = `${y}px`;
     
                 marker.addEventListener('click', function() {
                     this.remove();
                 });
     
                 hand.parentElement.appendChild(marker);
             }
     
             // Clear markers function
             function clearMarkersLowerExtreme() {
                 document.querySelectorAll('.marker-lower-extreme').forEach(marker => marker.remove());
             }
     
             // Add event listeners for legs
             leftHandLowerExtreme.addEventListener('click', addMarkerLowerExtreme);
             rightHandLowerExtreme.addEventListener('click', addMarkerLowerExtreme);
     
         </script>
         <hr style="border-top: 2px dotted black; width: 100%;">
         <label for="exam" class="form-label">EXAMINATION OF CHEST(INCLUDING CLAVICLE):</label>
         <div class="chest-container">
            <div class="chest-wrapper">
                <img id="chestImage" class="chest-image" src="http://localhost:8000/img13.png" alt="Clavicle Image">
            </div>
        </div>
        <div class="radio-group">
            <label>
                <input type="radio" name="openWoundsChest" value="no" checked> No Open Wounds
            </label>
            <label>
                <input type="radio" name="openWoundsChest" value="yes"> Open Wounds Present
            </label>
        </div>
    
        <textarea 
            id="woundDescriptionChest" 
            rows="4" 
            placeholder="Describe the wound(s): location, size, appearance..."
        ></textarea>
    
        <script>
            const chestImage = document.getElementById("chestImage");
            const clearMarkersBtnChest = document.getElementById("clearMarkersBtnChest");
            const woundRadiosChest = document.getElementsByName('openWoundsChest');
            const woundDescriptionChest = document.getElementById('woundDescriptionChest');
    
            // Show/Hide wound description textarea
            woundRadiosChest.forEach(radio => {
                radio.addEventListener('change', function() {
                    woundDescriptionChest.style.display = this.value === 'yes' ? 'block' : 'none';
                });
            });
    
            // Add marker function
            function addMarkerChest(event) {
                const marker = document.createElement("div");
                marker.classList.add("marker-chest");
    
                const chest = event.target;
                const rect = chest.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
    
                marker.style.left = `${x}px`;
                marker.style.top = `${y}px`;
    
                // Remove marker on click
                marker.addEventListener('click', function() {
                    this.remove();
                });
    
                chest.parentElement.appendChild(marker);
            }
    
            // Clear markers function
            function clearMarkersChest() {
                document.querySelectorAll('.marker-chest').forEach(marker => marker.remove());
            }
    
        </script>
        <hr style="border-top: 2px dotted black; width: 100%;">
        <label for="exam" class="form-label">EXAMINATION OF SPINE:</label>
    <div class="container-spine">
        <p>Are the findings WNL??</p>
        <label>
            <input type="radio" name="normalLengthSpine" value="yes"> Yes
        </label>
        <label>
            <input type="radio" name="normalLengthSpine" value="no"> No
        </label>

        <textarea 
            id="descriptionBoxSpine" 
            rows="4" 
            placeholder="Describe ..."
        ></textarea>
    </div>

    <script>
        const radioButtonsSpine = document.getElementsByName("normalLengthSpine");
        const descriptionBoxSpine = document.getElementById("descriptionBoxSpine");

        // Event listener to show/hide description box
        radioButtonsSpine.forEach(radio => {
            radio.addEventListener("change", function() {
                descriptionBoxSpine.style.display = this.value === "no" ? "block" : "none";
            });
        });
    </script>
    <hr style="border-top: 2px dotted black; width: 100%;">
    <label for="exam" class="form-label">EXAMINATION OF ABDOMEN:</label>
    
    <div class="container-abdomen">
        <p>Are the findings WNL??</p>
        <label>
            <input type="radio" name="normalLengthabdomen" value="yes"> Yes
        </label>
        <label>
            <input type="radio" name="normalLengthabdomen" value="no"> No
        </label>

        <textarea 
            id="descriptionBoxabdomen" 
            rows="4" 
            placeholder="Describe ..."
        ></textarea>
    </div>

    <script>
        const radioButtonsabdomen = document.getElementsByName("normalLengthabdomen");
        const descriptionBoxabdomen = document.getElementById("descriptionBoxabdomen");

        // Event listener to show/hide description box
        radioButtonsabdomen.forEach(radio => {
            radio.addEventListener("change", function() {
                descriptionBoxabdomen.style.display = this.value === "no" ? "block" : "none";
            });
        });
    </script>
    <hr style="border-top: 2px dotted black; width: 100%;">
                     <label for="head" class="form-label">HEAD INJURY STATUS:</label>
                     <h6>History of:</h6>
                     <div class="row">
                         <div class="col-md-4">
                             <label for="cons" class="form-label">Loss of Consciousness:</label>
                             <select class="form-select" id="consciousness">
                                 <option value="yes">Yes</option>
                                 <option value="no">No</option>
                                 </select>
                         </div>
                         <div class="col-md-4">
                             <label for="bleed" class="form-label">ENT Bleed:</label>
                             <select class="form-select" id="entbleed">
                                 <option value="yes">Yes</option>
                                 <option value="no">No</option>
                                 </select>
                         </div>
                         <div class="col-md-4">
                             <label for="vomit" class="form-label">Vomiting:</label>
                             <select class="form-select" id="vomiting">
                                 <option value="yes">Yes</option>
                                 <option value="no">No</option>
                                 </select>
                         </div>
                     </div>
                     
                    <div class="container gcs-container">
                        <div class="row">
                            <div class="col-12 text-center mb-3">
                                <label for="glascow">Glasgow Coma Scale:</label>
                            </div>
                        </div>
                        <div class="row">
                            <!-- Eye Response (E) -->
                            <div class="col-md-4">
                                <label for="eyeResponse">E =</label>
                                <select id="eyeResponse" class="form-select d-inline w-auto">
                                    <option value="">__</option>
                                    <script>
                                        for (let i = 1; i <= 4; i++) {
                                            document.write(`<option value="${i}">${i}</option>`);
                                        }
                                    </script>
                                </select> /4
                            </div>
                            <!-- Verbal Response (V) -->
                            <div class="col-md-4">
                                <label for="verbalResponse">V =</label>
                                <select id="verbalResponse" class="form-select d-inline w-auto">
                                    <option value="">__</option>
                                    <script>
                                        for (let i = 1; i <= 5; i++) {
                                            document.write(`<option value="${i}">${i}</option>`);
                                        }
                                    </script>
                                </select> /5
                            </div>
                            <!-- Motor Response (M) -->
                            <div class="col-md-4">
                                <label for="motorResponse">M =</label>
                                <select id="motorResponse" class="form-select d-inline w-auto">
                                    <option value="">__</option>
                                    <script>
                                        for (let i = 1; i <= 6; i++) {
                                            document.write(`<option value="${i}">${i}</option>`);
                                        }
                                    </script>
                                </select> /6
                            </div>
                        </div>
                    </div>
                    <hr style="border-top: 2px dotted black; width: 100%;">
                    <label for="diagnosis" class="form-label">DIAGNOSIS:</label>
                   
                    <div class="container">
                        
                        <textarea id="diagnosis" name="diagnosis" placeholder="Enter diagnosis details..."></textarea>
                    </div>
                    <hr style="border-top: 2px dotted black; width: 100%;">
                     <label for="further" class="form-label">Further investigations:</label>
                     
                    <script>
                        function toggleInput(checkbox, inputId) {
                            document.getElementById(inputId).style.display = checkbox.checked ? 'inline' : 'none';
                        }
                    </script>
                     <table>
                        <tr>
                            <th>INITIAL TREATMENT GIVEN</th>
                            <th>PROVISIONAL PLAN FOR FURTHER MANAGEMENT</th>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox"> Wound Lavage<br>
                                <input type="checkbox"> Wound Suturing<br>
                                <input type="checkbox"> Reduction Of Dislocations/Fractures<br>
                                <input type="checkbox"> Dressing<br>
                                <input type="checkbox"> Compression Bandage<br>
                                <input type="checkbox"> Pop Slab/Cast<br>
                                <input type="checkbox"> Posted For Debridement<br>
                                <input type="checkbox" id="others" onclick="toggleInput(this, 'othersText')"> Others (Please Specify)
                                <input type="text" id="othersText" style="display: none;">
                            </td>
                            <td>
                                <input type="checkbox"> Posted For Emergency OT<br>
                                <input type="checkbox"> Admit And Optimize Before OT<br>
                                <input type="checkbox"> Posted For Elective OT<br>
                                <input type="checkbox"> Discharge Against Medical Advice<br>
                                <input type="checkbox"> Co-Treatment On Consultation Basis<br>
                                <input type="checkbox"> Needs Reassessment<br>
                                <input type="checkbox" id="refer" onclick="toggleInput(this, 'referText')"> Refer To 
                                <input type="text" id="referText" style="display: none;"> Department, And To Take Over After Primary Intervention<br>
                                <input type="checkbox"> Treatment Completed And Sent Home<br>
                                <input type="checkbox" id="review" onclick="toggleInput(this, 'reviewText'); toggleInput(this, 'investigationsText');"> Review in Hand surgery OPD on 
                                <input type="date" id="reviewText" style="display: none;"> with following investigations<br>
                                <textarea id="investigationsText" style="display: none;"></textarea>
                            </td>
                        </tr>
                    </table>
                    <hr style="border-top: 2px dotted black; width: 100%;">
                     
                     <div class="container2">
                        <div class="column">
                            <label for="residentName">Attending Resident Name:</label>
                            <input type="text" id="residentName" name="residentName">
                            <label for="residentDate">Date:</label>
                            <input type="date" id="residentDate" name="residentDate">
                        </div>
                        <div class="column">
                            <label for="staffName">Attending Staff Name:</label>
                            <input type="text" id="staffName" name="staffName">
                            <label for="staffDate">Date:</label>
                            <input type="date" id="staffDate" name="staffDate">
                        </div>
                    </div>
                    <hr style="border: 1px solid #000; margin-top: 20px;">
                    <label for="videos" class="form-label fw-bold">Upload Video Files (Max 5)</label>
    <input type="file" id="videoInput" accept="video/*" multiple>
    <br><br>
    <div id="videoContainer"></div>
    <script>
        document.getElementById('videoInput').addEventListener('change', function(event) {
            const files = event.target.files;
            const videoContainer = document.getElementById('videoContainer');
            videoContainer.innerHTML = "";
            
            if (files.length > 5) {
                alert("You can upload a maximum of 5 videos.");
                return;
            }
            
            for (let i = 0; i < files.length; i++) {
                const videoPlayer = document.createElement('video');
                videoPlayer.width = 300;
                videoPlayer.controls = true;
                videoPlayer.src = URL.createObjectURL(files[i]);
                videoContainer.appendChild(videoPlayer);
            }
        });
    </script>
            <div class="row">
             <div class="col-md-6">
           <button id="add-to-database-button1" type="button" class="btn btn-warning btn-block mr-1">Add to Database</button>
         </div>
         <div class="col-md-6">
             <button id="generatepdf" type="button" class="btn btn-warning btn-block mr-1">Generate Pdf</button>
         </div> </div>
                     
         </form></div>
     </div>
    </div>
 
   <div class="container" id="add_patient2" >
     <h3>Acute Hand Injury Sheet( Part 2 )</h3>
     <div class="well">
       <form id="form2">
        <div class="row mb-3">
            <div class="col-md-6">
              <label for="PName" class="form-label">Patient Name</label>
              <input type="text" class="form-control" id="PName">
            </div>
            <div class="col-md-6">
              <label for="PAge" class="form-label">Patient Age</label>
              <input type="number" class="form-control" id="PAge">
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label">Hand Dominance:</label>
              <div class="d-flex justify-content-center gap-3">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="Dominance" id="Left" value="Left">
                  <label class="form-check-label" for="Left">Left</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="Dominance" id="Right" value="Right">
                  <label class="form-check-label" for="Right">Right</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="Dominance" id="Ambidextrous" value="Ambidextrous">
                  <label class="form-check-label" for="Ambidextrous">Ambidextrous</label>
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <label class="form-label">Sex:</label>
              <div class="d-flex justify-content-center gap-3">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="Sex" id="Male" value="Male">
                  <label class="form-check-label" for="Male">Male</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="Sex" id="Female" value="Female">
                  <label class="form-check-label" for="Female">Female</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="Sex" id="Others" value="Others">
                  <label class="form-check-label" for="Others">Others</label>
                </div>
              </div>
            </div>
          </div>
          
         <div class="mb-3">
           <label for="HNum" class="form-label">Hospital No:</label>
           <input type="text" class="form-control" id="HNum">
         </div>
         <hr style="border-top: 2px dotted black; width: 100%;">

         <h3>A. INTEGUMENT LOSS</h3>
         <div class="d-flex justify-content-center gap-3">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="Dominance" id="Left" value="Left">
              <label class="form-check-label" for="Left">Present</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="Dominance" id="Right" value="Right">
              <label class="form-check-label" for="Right">Absent</label>
            </div>
          </div>
<hr style="border-top: 2px dotted black; width: 100%;">
         <h4>FINGER TIP INJURY</h4>
         <h5>Procedure</h5>
         <table class="table table-bordered text-center">
            <thead>
              <tr>
                <th>Procedure</th>
                <th>Type</th>
                <th>Thumb / 1st ray</th>
                <th>Index / 2nd ray</th>
                <th>Middle / 3rd ray</th>
                <th>Ring / 4th ray</th>
                <th>Little / 5th ray</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Nail Bed Primary Repair</td>
                <td>-</td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
              </tr>
              <tr>
                <td rowspan="2">Nail Bed Grafting</td>
                <td>With Flap</td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
              </tr>
              <tr>
                <td>Without Flap</td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
              </tr>
              <tr>
                <td>Nail Bed Excision</td>
                <td>-</td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
              </tr>
              <tr>
                <td rowspan="2">Terminalization</td>
                <td>With Shortening</td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
              </tr>
              <tr>
                <td>Without Shortening</td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
              </tr>
              <tr>
                <td>Ray Amputation</td>
                <td>-</td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
              </tr>
            </tbody>
          </table>
          <hr style="border-top: 2px dotted black; width: 100%;">
          <h5>DIGITS:</h5>
          <label for="form-label" class="form-label fw-bold">Findings - Primary Soft Tissue Coverage:</label>
          
          <div class="d-flex justify-content-center gap-3">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="SoftTissueCoverage" id="SoftTissuePresent" value="Present" onclick="toggleTables(true)">
              <label class="form-check-label" for="SoftTissuePresent">Present</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="SoftTissueCoverage" id="SoftTissueAbsent" value="Absent" onclick="toggleTables(false)">
              <label class="form-check-label" for="SoftTissueAbsent">Absent</label>
            </div>
          </div>
          
          <!-- DIGITS Table -->
          <div id="digitsTable" style="display: none;">
            <table class="table table-bordered text-center mt-3">
              <thead>
                <tr>
                  <th>DIGITS</th>
                  <th>Thumb</th>
                  <th>Index</th>
                  <th>Middle</th>
                  <th>Ring</th>
                  <th>Little</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Palmar</td>
                  <td><input type="checkbox"></td>
                  <td><input type="checkbox"></td>
                  <td><input type="checkbox"></td>
                  <td><input type="checkbox"></td>
                  <td><input type="checkbox"></td>
                </tr>
                <tr>
                  <td>Dorsal</td>
                  <td><input type="checkbox"></td>
                  <td><input type="checkbox"></td>
                  <td><input type="checkbox"></td>
                  <td><input type="checkbox"></td>
                  <td><input type="checkbox"></td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- PROCEDURE Table -->
          <div id="procedureTable" style="display: none;">
            <h5>Procedure:</h5>
            <table class="table table-bordered">
              <tbody>
                <tr>
                  <td>SSG</td>
                  <td><input type="checkbox"></td>
                </tr>
                <tr>
                  <td>Flap - Local rotational flap</td>
                  <td><input type="checkbox"></td>
                </tr>
                <tr>
                  <td>&emsp; a. Same finger</td>
                  <td><input type="checkbox"></td>
                </tr>
                <tr>
                  <td>&emsp; b. Cross finger</td>
                  <td><input type="checkbox"></td>
                </tr>
                <tr>
                  <td>Flap - Free flap</td>
                  <td><input type="checkbox"></td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <script>
            function toggleTables(show) {
              document.getElementById("digitsTable").style.display = show ? "block" : "none";
              document.getElementById("procedureTable").style.display = show ? "block" : "none";
            }
          </script>
          <hr style="border-top: 2px dotted black; width: 100%;">
          <div class="container">
            <div class="radio-group">
                <label>
                    <input type="radio" name="critical" value="exposed" onclick="document.getElementById('joint_table').classList.remove('hidden')"> 
                    Critical Structure Exposed
                </label>
                &nbsp;&nbsp;&nbsp;
                <label>
                    <input type="radio" name="critical" value="not_exposed" onclick="document.getElementById('joint_table').classList.add('hidden')"> 
                    Critical Structure NOT Exposed
                </label>
            </div>
            
            <table id="joint_table" class="hidden">
                <thead>
                    <tr>
                        <th>Region</th>
                        <th>Volar Skin Loss (in cm)<br>Critical Structure Exposed</th>
                        <th>Dorsum Skin Loss (in cm)<br>Critical Structure Exposed</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Arm</td>
                        <td><input type="number" step="0.01" min="0"></td>
                        <td><input type="number" step="0.01" min="0"></td>
                    </tr>
                    <tr>
                        <td>Forearm</td>
                        <td><input type="number" step="0.01" min="0"></td>
                        <td><input type="number" step="0.01" min="0"></td>
                    </tr>
                    <tr>
                        <td>Hand</td>
                        <td><input type="number" step="0.01" min="0"></td>
                        <td><input type="number" step="0.01" min="0"></td>
                    </tr>
                </tbody>
            </table>
        </div>
     

     <hr style="border: 1px solid #000; margin-top: 20px;">
     <h3>B. SKELETAL-</h3>
     <!-- Skeletal Radio Buttons -->
<div class="d-flex justify-content-center gap-3">
    <div class="form-check">
      <input class="form-check-input" type="radio" name="SKELETAL" id="SKELETAL_Present" value="Present" onclick="toggleSkeletalTable()">
      <label class="form-check-label" for="SKELETAL_Present">Present</label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="radio" name="SKELETAL" id="SKELETAL_Absent" value="Absent" onclick="toggleSkeletalTable()">
      <label class="form-check-label" for="SKELETAL_Absent">Absent</label>
    </div>
  </div>
  
  <!-- Skeletal Table (Initially Hidden) -->
  <div id="skeletalTable" style="display: none;">
    <table class="table table-bordered text-center">
      <thead>
        <tr>
          <th rowspan="2">Category</th>
          <th rowspan="2">Type</th>
          <th colspan="2">Thumb</th>
          <th colspan="2">Index</th>
          <th colspan="2">Middle</th>
          <th colspan="2">Ring</th>
          <th colspan="2">Little</th>
        </tr>
        <tr>
          <th>Present</th>
          <th>Bone Loss / Comminution</th>
          <th>Present</th>
          <th>Bone Loss / Comminution</th>
          <th>Present</th>
          <th>Bone Loss / Comminution</th>
          <th>Present</th>
          <th>Bone Loss / Comminution</th>
          <th>Present</th>
          <th>Bone Loss / Comminution</th>
        </tr>
      </thead>
      <tbody>
        <!-- Digital Fractures -->
        <tr><td rowspan="5"><b>Digital Fractures</b></td><td>DPx</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
        <tr><td>DIPJ</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
        <tr><td>MPx</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
        <tr><td>PIPJ</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
        <tr><td>PPx</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
  
        <!-- Metacarpal -->
        <tr><td rowspan="4"><b>Metacarpal</b></td><td>Head</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
        <tr><td>Neck</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
        <tr><td>Shaft</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
        <tr><td>Base</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
  
        <!-- Dislocation -->
        <tr><td rowspan="3"><b>Dislocation</b></td><td>DIP</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
        <tr><td>PIP</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
        <tr><td>MCP</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
  
        <!-- Ligament Injury -->
        <tr><td colspan="2"><b>Ligament Injury (Sprain/Rupture/Avulsion)</b></td><td colspan="10"><input type="checkbox"></td></tr>
      </tbody>
    </table>
  </div>
  
  <!-- JavaScript for Toggle -->
  <script>
  function toggleSkeletalTable() {
      var skeletalPresent = document.getElementById("SKELETAL_Present").checked;
      document.getElementById("skeletalTable").style.display = skeletalPresent ? "block" : "none";
  }
  </script>
  
  <table class="table table-bordered text-center">
    <thead>
      <tr>
        <th></th>
        <th>Scaphoid</th>
        <th>Lunate</th>
        <th>Triquetral</th>
        <th>Pisiform</th>
        <th>Trapezium</th>
        <th>Trapezoid</th>
        <th>Capitate</th>
        <th>Hamate</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><b>Conservative Treatment</b></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
      </tr>
      <tr>
        <td><b>External Fixation</b></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
      </tr>
      <tr>
        <td><b>ORIF</b></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
      </tr>
      <tr>
        <td><b>CRIF</b></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
      </tr>
    </tbody>
  </table>
  
  <table class="table table-bordered text-center">
    <thead>
      <tr>
        <th></th>
        <th colspan="3">Radius</th>
        <th colspan="4">Ulna</th>
        <th colspan="3">Humerus</th>
      </tr>
      <tr>
        <th></th>
        <th>Head / Neck</th>
        <th>Shaft</th>
        <th>DER</th>
        <th>Olecranon</th>
        <th>Shaft</th>
        <th>Head</th>
        <th>Styloid</th>
        <th>Head</th>
        <th>Shaft</th>
        <th>DEH</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><b>Conservative Treatment</b></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
      </tr>
      <tr>
        <td><b>Bone Loss / Commination</b></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
      </tr>
      <tr>
        <td><b>External Fixation</b></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
      </tr>
      <tr>
        <td><b>ORIF</b></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
      </tr>
      <tr>
        <td><b>CRIF</b></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
      </tr>
    </tbody>
  </table>
           <hr style="border: 1px solid #000; margin-top: 20px;">
 
         <h3>C. MOTOR</h3>
         <div class="d-flex justify-content-center gap-3">
            <input type="radio" id="motor_present" name="motor" value="Present" onchange="toggleTable()">
            <label for="motor_present" class="me-3">Present</label>
            <input type="radio" id="motor_absent" name="motor" value="Absent" onchange="toggleTable()">
            <label for="motor_absent">Absent</label>
          </div>
         <label for="Findings" class="form-label">Findings</label>
         <table id="assessment-table">
            <tr>
              <th colspan="2"></th>
              <th>Thumb</th>
              <th>Index</th>
              <th>Middle</th>
              <th>Ring</th>
              <th>Little</th>
            </tr>
            <tr>
              <td colspan="2"></td>
              <td>< 40% OR Complete</td>
              <td>< 40% OR Complete</td>
              <td>< 40% OR Complete</td>
              <td>< 40% OR Complete</td>
              <td>< 40% OR Complete</td>
            </tr>
            <tr>
              <td rowspan="4" class="vertical-header">Extensor tendon</td>
              <td class="zone-cell">Zone 1,2</td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
            </tr>
            <tr>
              <td class="zone-cell">Zone 3,4</td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
            </tr>
            <tr>
              <td class="zone-cell">Zone 5</td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
            </tr>
            <tr>
              <td class="zone-cell">Zone 6, 7, 8</td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
            </tr>
            <tr>
              <td rowspan="4" class="vertical-header">Flexor profundus (Including FPL)</td>
              <td class="zone-cell">Zone 1</td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
            </tr>
            <tr>
              <td class="zone-cell">Zone 2</td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
            </tr>
            <tr>
              <td class="zone-cell">Zone 3</td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
            </tr>
            <tr>
              <td class="zone-cell">Zone 4, 5 belly</td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
            </tr>
            <tr>
              <td rowspan="2" class="vertical-header">Flexor superficialis</td>
              <td class="zone-cell">Distal to wrist</td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
            </tr>
            <tr>
              <td class="zone-cell">Proximal to wrist</td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
              <td class="checkbox-cell"><input type="checkbox"></td>
            </tr>
            <tr>
              <td colspan="2" class="vertical-header">Intrinsic muscles</td>
              <td colspan="5"><input type="text" class="text-input"></td>
            </tr>
            <tr>
              <td colspan="2" class="vertical-header">Crush / Avulsion</td>
              <td colspan="5"><input type="text" class="text-input"></td>
            </tr>
          </table>
          <script>
            function toggleTable() {
              const presentRadio = document.getElementById('motor_present');
              const table = document.getElementById('assessment-table');
              
              if (presentRadio.checked) {
                table.style.display = 'table';
              } else {
                table.style.display = 'none';
              }
            }
          </script>
         
         <table border="1" style="width: 100%; text-align: center; border-collapse: collapse;">
            <tr>
              <th rowspan="2">Arm</th>
              <th rowspan="2"></th>
              <th colspan="3">Muscle Details</th>
            </tr>
            <tr>
              <th>Origin</th>
              <th>Belly</th>
              <th>Insertion</th>
            </tr>
            <tr>
              <td rowspan="3"><b>Anterior Compartment</b></td>
              <td>Biceps brachii</td>
              <td><input type="checkbox"></td>
              <td><input type="checkbox"></td>
              <td><input type="checkbox"></td>
            </tr>
            <tr>
              <td>Coracobrachialis</td>
              <td><input type="checkbox"></td>
              <td><input type="checkbox"></td>
              <td><input type="checkbox"></td>
            </tr>
            <tr>
              <td>Brachialis muscles</td>
              <td><input type="checkbox"></td>
              <td><input type="checkbox"></td>
              <td><input type="checkbox"></td>
            </tr>
            <tr>
              <td><b>Posterior Compartment</b></td>
              <td>Triceps brachii</td>
              <td><input type="checkbox"></td>
              <td><input type="checkbox"></td>
              <td><input type="checkbox"></td>
            </tr>
          </table>
          
         <hr style="border: 1px solid #000; margin-top: 20px;">
           
         <h3>D. NEUROVASCULAR</h3>
         <div class="d-flex justify-content-center gap-3">
            <input type="radio" id="neurovascular_present_radio" name="neurovascular_status" value="Present" onchange="toggleNeuroVascularTable()">
            <label for="neurovascular_present_radio" class="me-3">Present</label>
            <input type="radio" id="neurovascular_absent_radio" name="neurovascular_status" value="Absent" onchange="toggleNeuroVascularTable()">
            <label for="neurovascular_absent_radio">Absent</label>
          </div>
        
          <table id="neurovascular-assessment-table">
            <tr>
              <th colspan="2" rowspan="2" class="structure-header">Structure involved</th>
              <th colspan="3">Present</th>
              <th rowspan="3">Absent</th>
            </tr>
            <tr>
              <th colspan="2">Repairable</th>
              <th rowspan="2">Not repairable</th>
            </tr>
            <tr>
              <th colspan="2"></th>
              <th>Done</th>
              <th>Not done</th>
            </tr>
            <tr>
              <td rowspan="4" class="vertical-header">Nerve</td>
              <td class="structure-cell">Main Median nerve</td>
              <td><input type="checkbox" id="median_nerve_done_checkbox"></td>
              <td><input type="checkbox" id="median_nerve_not_done_checkbox"></td>
              <td><input type="checkbox" id="median_nerve_not_repairable_checkbox"></td>
              <td><input type="checkbox" id="median_nerve_absent_checkbox"></td>
            </tr>
            <tr>
              <td class="structure-cell">Main Ulnar nerve</td>
              <td><input type="checkbox" id="ulnar_nerve_done_checkbox"></td>
              <td><input type="checkbox" id="ulnar_nerve_not_done_checkbox"></td>
              <td><input type="checkbox" id="ulnar_nerve_not_repairable_checkbox"></td>
              <td><input type="checkbox" id="ulnar_nerve_absent_checkbox"></td>
            </tr>
            <tr>
              <td class="structure-cell">Motor branch of median nerve</td>
              <td><input type="checkbox" id="motor_median_done_checkbox"></td>
              <td><input type="checkbox" id="motor_median_not_done_checkbox"></td>
              <td><input type="checkbox" id="motor_median_not_repairable_checkbox"></td>
              <td><input type="checkbox" id="motor_median_absent_checkbox"></td>
            </tr>
            <tr>
              <td class="structure-cell">Deep branch of ulnar nerve</td>
              <td><input type="checkbox" id="deep_ulnar_done_checkbox"></td>
              <td><input type="checkbox" id="deep_ulnar_not_done_checkbox"></td>
              <td><input type="checkbox" id="deep_ulnar_not_repairable_checkbox"></td>
              <td><input type="checkbox" id="deep_ulnar_absent_checkbox"></td>
            </tr>
            <tr>
              <td rowspan="2" class="vertical-header">Artery</td>
              <td class="structure-cell">Radial artery</td>
              <td><input type="checkbox" id="radial_artery_done_checkbox"></td>
              <td><input type="checkbox" id="radial_artery_not_done_checkbox"></td>
              <td><input type="checkbox" id="radial_artery_not_repairable_checkbox"></td>
              <td><input type="checkbox" id="radial_artery_absent_checkbox"></td>
            </tr>
            <tr>
              <td class="structure-cell">Ulnar artery</td>
              <td><input type="checkbox" id="ulnar_artery_done_checkbox"></td>
              <td><input type="checkbox" id="ulnar_artery_not_done_checkbox"></td>
              <td><input type="checkbox" id="ulnar_artery_not_repairable_checkbox"></td>
              <td><input type="checkbox" id="ulnar_artery_absent_checkbox"></td>
            </tr>
          </table>
          <script>
            function toggleNeuroVascularTable() {
              const presentRadio = document.getElementById('neurovascular_present_radio');
              const table = document.getElementById('neurovascular-assessment-table');
              
              if (presentRadio.checked) {
                table.style.display = 'table';
              } else {
                table.style.display = 'none';
              }
            }
          </script>
         
             <label for="Disvas" class="form-label">Disvascularity Requiring revascularization:</label>
             <label>
                <input type="radio" name="Disvas" value="Yes"> Yes
              </label>
              <label>
                <input type="radio" name="Disvas" value="No"> No
              </label>
              
              <table>
                <tr>
                    <th></th>
                    <th></th>
                    <th>Thumb</th>
                    <th>Index</th>
                    <th>Middle</th>
                    <th>Ring</th>
                    <th>Little</th>
                </tr>
                <tr>
                    <td rowspan="2"><b>Digital nerve</b></td>
                    <td>Ulnar digital</td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>Radial digital</td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                </tr>
                <tr>
                    <td rowspan="2"><b>Digital Artery</b></td>
                    <td>Ulnar digital</td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>Radial digital</td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                </tr>
                <tr>
                    <td colspan="2"><b>Crush / Avulsion</b></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox"></td>
                </tr>
            </table>                      
            
            
           <hr style="border: 1px solid #000; margin-top: 20px;">
           <hr style="border: 1px solid #000; margin-top: 20px;">
<style>
    #customVideoContainer {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        gap: 10px;
    }
    video {
        max-width: 300px;
    }
</style>
<label for="customVideoInput" class="form-label fw-bold">Upload Video Files (Max 5)</label>
<input type="file" id="customVideoInput" accept="video/*" multiple>
<br><br>
<div id="customVideoContainer"></div>
<script>
    document.getElementById('customVideoInput').addEventListener('change', function(event) {
        const files = event.target.files;
        const videoContainer = document.getElementById('customVideoContainer');
        videoContainer.innerHTML = "";
        
        if (files.length > 5) {
            alert("You can upload a maximum of 5 videos.");
            return;
        }
        
        for (let i = 0; i < files.length; i++) {
            const videoPlayer = document.createElement('video');
            videoPlayer.width = 300;
            videoPlayer.controls = true;
            videoPlayer.src = URL.createObjectURL(files[i]);
            videoContainer.appendChild(videoPlayer);
        }
    });
</script>
         </div>
         <div class="row">
             <div class="col-md-6">
           <button id="add-to-database-button2" type="button" class="btn btn-warning btn-block mr-1">Add to Database</button>
         </div>
         <div class="col-md-6">
             <button id="generatePdf" type="button" class="btn btn-warning btn-block mr-1">Generate Pdf</button>
         </div></div>
       </form>
       </div>
     </div> </div> 
 </body>
 <script>
   document.addEventListener('DOMContentLoaded', function() {
    // ================ HELPER FUNCTIONS ================
    
    // Safely add event listener (checks if element exists first)
    function safeAddEventListener(selector, event, callback) {
        const element = document.querySelector(selector);
        if (element) {
            element.addEventListener(event, callback);
        } else {
            console.warn(`Element not found: ${selector}`);
        }
    }

    // ================ PDF GENERATION ================
    
    // PDF generation function
    async function generatePDF(formId) {
        let clonedForm = null;
        let loadingElement = null;
        
        try {
            // Show Loading Indicator
            loadingElement = document.createElement('div');
            Object.assign(loadingElement.style, {
                position: 'fixed', top: '50%', left: '50%',
                transform: 'translate(-50%, -50%)', backgroundColor: 'rgba(255, 255, 255, 0.9)',
                padding: '20px', borderRadius: '5px', boxShadow: '0 2px 10px rgba(0, 0, 0, 0.1)',
                zIndex: '9999'
            });
            loadingElement.innerHTML = 'Generating PDF...';
            document.body.appendChild(loadingElement);
            
            // Check if jsPDF is loaded
            if (!window.jspdf || !window.jspdf.jsPDF) {
                throw new Error('jsPDF library is not loaded. Please include it in your HTML.');
            }
            const { jsPDF } = window.jspdf;
            
            // Get form element
            const formElement = document.getElementById(formId);
            if (!formElement) throw new Error(`Form with ID '${formId}' not found`);
            
            // Clone form
            clonedForm = formElement.cloneNode(true);
            document.body.appendChild(clonedForm);
            
            // Style cloned form for PDF
            Object.assign(clonedForm.style, {
                position: 'absolute',
                top: '-9999px',
                left: '-9999px',
                width: formElement.offsetWidth + 'px',
                background: 'white',
                transform: 'none',
                display: 'block'
            });
            
            // Fix images in the cloned form
            const images = clonedForm.querySelectorAll('img');
            images.forEach(img => {
                if (!img.src || img.src.startsWith('file://')) {
                    const placeholder = document.createElement('div');
                    placeholder.style.width = '100px';
                    placeholder.style.height = '100px';
                    placeholder.style.backgroundColor = '#f0f0f0';
                    placeholder.style.display = 'inline-block';
                    placeholder.style.textAlign = 'center';
                    placeholder.style.lineHeight = '100px';
                    placeholder.textContent = 'Image';
                    img.parentNode.replaceChild(placeholder, img);
                }
            });
            
            // Remove buttons that shouldn't be in the PDF
            clonedForm.querySelectorAll('button, input[type="button"], input[type="submit"]').forEach(btn => {
                btn.remove();
            });
            
            // Convert form inputs to static text
            clonedForm.querySelectorAll('input, textarea, select').forEach(el => {
                if (el.type === 'checkbox' || el.type === 'radio') {
                    if (el.checked) {
                        el.insertAdjacentHTML('afterend', ' ');
                    }
                } else if (el.type === 'file') {
                    el.remove();
                } else {
                    if (el.value) {
                        const textNode = document.createElement('span');
                        textNode.textContent = el.value;
                        textNode.style.fontWeight = 'bold';
                        el.parentNode.insertBefore(textNode, el.nextSibling);
                    }
                }
            });
            
            // Add delay to ensure everything is rendered
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Create PDF using DOM-to-Image instead of html2canvas
            loadingElement.innerHTML = 'Creating PDF...';
            
            // If using html2canvas, set specific options
            const canvas = await html2canvas(clonedForm, {
                useCORS: true,
                allowTaint: true,
                removeContainer: true,
                backgroundColor: '#ffffff',
                scale: 2,
                logging: false,
                imageTimeout: 30000,
                onclone: function(clonedDoc) {
                    // Fix any remaining issues in the cloned document
                    const clonedCanvas = clonedDoc.querySelectorAll('canvas');
                    clonedCanvas.forEach(canvas => {
                        // Replace canvases with placeholder divs
                        const placeholder = document.createElement('div');
                        placeholder.style.width = canvas.width + 'px';
                        placeholder.style.height = canvas.height + 'px';
                        placeholder.style.border = '1px solid #ccc';
                        placeholder.style.backgroundColor = '#f9f9f9';
                        placeholder.style.display = 'inline-block';
                        placeholder.style.textAlign = 'center';
                        placeholder.style.lineHeight = canvas.height + 'px';
                        placeholder.textContent = 'Form Drawing';
                        canvas.parentNode.replaceChild(placeholder, canvas);
                    });
                }
            });
            
            // Create PDF from canvas
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });
            
            // Get dimensions
            const imgWidth = pdf.internal.pageSize.getWidth();
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            
            // Add canvas to PDF (handling multi-page if needed)
            let heightLeft = imgHeight;
            let position = 0;
            let pageHeight = pdf.internal.pageSize.getHeight();
            
            // First page
            pdf.addImage(canvas.toDataURL('image/jpeg', 0.95), 'JPEG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
            
            // Add additional pages if needed
            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                pdf.addPage();
                pdf.addImage(canvas.toDataURL('image/jpeg', 0.95), 'JPEG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }
            
            // Save PDF
            loadingElement.innerHTML = 'Saving PDF...';
            pdf.save(`${formId}_form.pdf`);
            
        } catch (error) {
            console.error('PDF generation failed:', error);
            alert('PDF generation failed: ' + error.message + '\nPlease check that all images are accessible and try again.');
            
            // Alternative approach if canvas is tainted
            if (error.message && error.message.includes('Tainted canvases')) {
                alert('Trying alternative approach for PDF generation...');
                
                try {
                    // Create simple PDF without images
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF();
                    
                    // Extract text from form
                    const formElement = document.getElementById(formId);
                    if (!formElement) throw new Error(`Form with ID '${formId}' not found`);
                    
                    const formData = new FormData(formElement);
                    let yPos = 20;
                    
                    pdf.setFontSize(20);
                    pdf.text('Form Data', 20, yPos);
                    yPos += 10;
                    pdf.setFontSize(12);
                    
                    // Add form data to PDF
                    for (let [key, value] of formData.entries()) {
                        // Check if we need to add a new page
                        if (yPos > 270) {
                            pdf.addPage();
                            yPos = 20;
                        }
                        
                        pdf.text(`${key}: ${value}`, 20, yPos);
                        yPos += 8;
                    }
                    
                    pdf.save(`${formId}_text_only.pdf`);
                    
                } catch (fallbackError) {
                    console.error('Fallback PDF generation failed:', fallbackError);
                    alert('All PDF generation methods failed. Please try again or contact support.');
                }
            }
        } finally {
            // Clean up
            clonedForm?.remove();
            loadingElement?.remove();
        }
    }
    
    // ================ ATTACH EVENT LISTENERS ================
    
    // Safely add event listeners to PDF generation buttons
    safeAddEventListener('#generatepdf', 'click', () => generatePDF('add_patient1'));
    safeAddEventListener('#generatePdf', 'click', () => generatePDF('add_patient2'));
    
    // If you have specific adjustForearmCanvasSize function missing, add a placeholder
    if (typeof adjustForearmCanvasSize === 'undefined') {
        window.adjustForearmCanvasSize = function() {
            console.log('adjustForearmCanvasSize called but not implemented');
        };
    }

    console.log('PDF generation system initialized successfully');
});


    // Logout function with confirmation
    document.getElementById("logout").addEventListener("click", function (event) {
            event.preventDefault();
            let confirmLogout = confirm("Are you sure you want to log out?");
            if (confirmLogout) {
                window.location.href = "login.html"; // Redirects to login page if confirmed
            }
        });</script>
 </html>